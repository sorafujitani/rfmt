#!/usr/bin/env ruby
# frozen_string_literal: true

# Suppress gem warnings for performance (saves ~2 seconds)
$VERBOSE = nil unless ENV['RFMT_VERBOSE']

require 'rfmt/cli'

# Known subcommands - if first arg is not one of these, prepend 'format'
SUBCOMMANDS = %w[format check version config cache init help].freeze

args = ARGV.dup
args.unshift('format') if args.empty? || (!SUBCOMMANDS.include?(args.first) && !args.first.start_with?('-'))

begin
  Rfmt::CLI.start(args)
rescue Interrupt
  puts "\nInterrupted"
  exit(130)
rescue StandardError => e
  warn "Error: #{e.message}"
  warn e.backtrace.join("\n") if ENV['DEBUG']
  exit(1)
end
