---
title: "Building from Source | fs0414/rfmt | DeepWiki"
source_url: "https://deepwiki.com/fs0414/rfmt/6.1-building-from-source"
fetched_at: "2026-01-13T10:53:43.101777+00:00"
---



Loading...

Index your code with Devin

[DeepWiki](https://deepwiki.com/)

[DeepWiki](https://deepwiki.com/)

[fs0414/rfmt](https://github.com/fs0414/rfmt "Open repository")

Index your code with

Devin

Edit WikiShare

Loading...

Last indexed: 3 January 2026 ([90c575](https://github.com/fs0414/rfmt/commits/90c575e6))

* [Overview](https://deepwiki.com/fs0414/rfmt/1-overview.html)
* [Architecture Overview](https://deepwiki.com/fs0414/rfmt/1.1-architecture-overview.html)
* [Key Concepts](https://deepwiki.com/fs0414/rfmt/1.2-key-concepts.html)
* [Getting Started](https://deepwiki.com/fs0414/rfmt/2-getting-started.html)
* [Installation](https://deepwiki.com/fs0414/rfmt/2.1-installation.html)
* [Configuration](https://deepwiki.com/fs0414/rfmt/2.2-configuration.html)
* [User Guides](https://deepwiki.com/fs0414/rfmt/3-user-guides.html)
* [CLI Usage](https://deepwiki.com/fs0414/rfmt/3.1-cli-usage.html)
* [Ruby API](https://deepwiki.com/fs0414/rfmt/3.2-ruby-api.html)
* [Editor Integration](https://deepwiki.com/fs0414/rfmt/3.3-editor-integration.html)
* [Core Systems](https://deepwiki.com/fs0414/rfmt/4-core-systems.html)
* [AST Representation](https://deepwiki.com/fs0414/rfmt/4.1-ast-representation.html)
* [Formatting Engine (Emitter)](https://deepwiki.com/fs0414/rfmt/4.2-formatting-engine-(emitter).html)
* [Parser Integration (PrismBridge)](https://deepwiki.com/fs0414/rfmt/4.3-parser-integration-(prismbridge).html)
* [Configuration System](https://deepwiki.com/fs0414/rfmt/4.4-configuration-system.html)
* [Caching System](https://deepwiki.com/fs0414/rfmt/4.5-caching-system.html)
* [Logging System](https://deepwiki.com/fs0414/rfmt/4.6-logging-system.html)
* [Formatting Behavior](https://deepwiki.com/fs0414/rfmt/5-formatting-behavior.html)
* [Control Flow Formatting](https://deepwiki.com/fs0414/rfmt/5.1-control-flow-formatting.html)
* [Exception Handling Formatting](https://deepwiki.com/fs0414/rfmt/5.2-exception-handling-formatting.html)
* [Lambda and Block Formatting](https://deepwiki.com/fs0414/rfmt/5.3-lambda-and-block-formatting.html)
* [Development](https://deepwiki.com/fs0414/rfmt/6-development.html)
* [Building from Source](https://deepwiki.com/fs0414/rfmt/6.1-building-from-source.html)
* [Testing](https://deepwiki.com/fs0414/rfmt/6.2-testing.html)
* [Release Process](https://deepwiki.com/fs0414/rfmt/6.3-release-process.html)
* [Reference](https://deepwiki.com/fs0414/rfmt/7-reference.html)
* [Node Types Reference](https://deepwiki.com/fs0414/rfmt/7.1-node-types-reference.html)
* [Configuration Options Reference](https://deepwiki.com/fs0414/rfmt/7.2-configuration-options-reference.html)
* [Error Codes Reference](https://deepwiki.com/fs0414/rfmt/7.3-error-codes-reference.html)
* [Performance and Benchmarks](https://deepwiki.com/fs0414/rfmt/7.4-performance-and-benchmarks.html)

Menu

# Building from Source

Relevant source files

* [.rubocop.yml](https://github.com/fs0414/rfmt/blob/90c575e6/.rubocop.yml)
* [CHANGELOG.md](https://github.com/fs0414/rfmt/blob/90c575e6/CHANGELOG.md)
* [Cargo.lock](https://github.com/fs0414/rfmt/blob/90c575e6/Cargo.lock)
* [Gemfile.lock](https://github.com/fs0414/rfmt/blob/90c575e6/Gemfile.lock)
* [ext/rfmt/Cargo.toml](https://github.com/fs0414/rfmt/blob/90c575e6/ext/rfmt/Cargo.toml)
* [rfmt.gemspec](https://github.com/fs0414/rfmt/blob/90c575e6/rfmt.gemspec)
* [spec/spec\_helper.rb](https://github.com/fs0414/rfmt/blob/90c575e6/spec/spec_helper.rb)

This page provides comprehensive instructions for building `rfmt` from source code. Building from source is necessary for development work, contributing to the project, or creating custom builds for unsupported platforms. For standard installation from RubyGems, see [Installation](https://deepwiki.com/fs0414/rfmt/2.1-installation.html). For information about the release process, see [Release Process](https://deepwiki.com/fs0414/rfmt/6.3-release-process.html).

## Overview

Building `rfmt` from source involves two distinct compilation steps due to its hybrid architecture:

1. **Rust compilation**: The core formatting engine (in `ext/rfmt/src/`) must be compiled to a native library
2. **Ruby gem packaging**: The Ruby wrapper code (in `lib/`) is packaged along with the compiled Rust binary

The build process uses `rb-sys` to bridge Ruby and Rust, automatically generating FFI bindings and compiling the Rust code as a Ruby C extension.

## Prerequisites

### Required Software

| Component | Minimum Version | Purpose |
| --- | --- | --- |
| Ruby | 3.1.0 | Host language and gem runtime |
| RubyGems | 3.0.0 | Package management |
| Rust | 1.70+ | Core formatting engine compilation |
| Cargo | (bundled with Rust) | Rust build tool and dependency management |
| C compiler | System default | Required by rb-sys for FFI |

**Sources:** [rfmt.gemspec15](https://github.com/fs0414/rfmt/blob/90c575e6/rfmt.gemspec#L15-L15) [ext/rfmt/Cargo.toml1-11](https://github.com/fs0414/rfmt/blob/90c575e6/ext/rfmt/Cargo.toml#L1-L11)

### Platform-Specific Requirements

**Sources:** [Gemfile.lock99-102](https://github.com/fs0414/rfmt/blob/90c575e6/Gemfile.lock#L99-L102) [ext/rfmt/Cargo.toml14-16](https://github.com/fs0414/rfmt/blob/90c575e6/ext/rfmt/Cargo.toml#L14-L16)

## Installing Dependencies

### Ruby Dependencies

Install all Ruby dependencies using Bundler:

This installs:

* **Development dependencies**: `rspec`, `rubocop`, `lefthook`, `simplecov`
* **Build dependencies**: `rake`, `rake-compiler`, `rb_sys`
* **Runtime dependencies**: `prism`, `parallel`, `diff-lcs`, `diffy`

**Sources:** [Gemfile.lock103-122](https://github.com/fs0414/rfmt/blob/90c575e6/Gemfile.lock#L103-L122)

### Rust Toolchain Setup

The Rust toolchain must support the 2021 edition:

**Sources:** [ext/rfmt/Cargo.toml4](https://github.com/fs0414/rfmt/blob/90c575e6/ext/rfmt/Cargo.toml#L4-L4)

## Compilation Process

### Directory Structure

```
rfmt/
├── ext/rfmt/              # Rust extension source
│   ├── Cargo.toml         # Rust package manifest
│   ├── extconf.rb         # rb-sys build configuration
│   └── src/
│       ├── lib.rs         # FFI entry point
│       ├── emitter/       # Formatting engine
│       ├── ast/           # AST definitions
│       ├── logging/       # Logger implementation
│       └── ...
├── lib/rfmt/              # Ruby wrapper code
│   ├── cli.rb             # CLI implementation
│   ├── prism_bridge.rb    # AST serialization
│   ├── cache.rb           # Caching system
│   └── config.rb          # Configuration
├── Cargo.toml             # Workspace root
└── Cargo.lock             # Locked dependencies
```

**Sources:** [rfmt.gemspec45-53](https://github.com/fs0414/rfmt/blob/90c575e6/rfmt.gemspec#L45-L53)

### Build Workflow

**Sources:** [rfmt.gemspec36](https://github.com/fs0414/rfmt/blob/90c575e6/rfmt.gemspec#L36-L36) [ext/rfmt/Cargo.toml9-11](https://github.com/fs0414/rfmt/blob/90c575e6/ext/rfmt/Cargo.toml#L9-L11)

### Standard Build Command

Compile the Rust extension using rake:

The compiled library will be placed in:

* **Linux**: `lib/rfmt/rfmt.so`
* **macOS**: `lib/rfmt/rfmt.bundle`
* **Windows**: `lib/rfmt/rfmt.dll`

**Sources:** [rfmt.gemspec36](https://github.com/fs0414/rfmt/blob/90c575e6/rfmt.gemspec#L36-L36)

### Rust Dependencies

The Rust compilation pulls in numerous dependencies via Cargo:

**Sources:** [ext/rfmt/Cargo.toml14-46](https://github.com/fs0414/rfmt/blob/90c575e6/ext/rfmt/Cargo.toml#L14-L46) [Cargo.lock1221-1246](https://github.com/fs0414/rfmt/blob/90c575e6/Cargo.lock#L1221-L1246)

## Building Platform-Specific Gems

### Native Gem Architecture

`rfmt` distributes pre-compiled native gems for common platforms to avoid requiring users to have a Rust toolchain. The build process creates platform-specific gems with embedded binaries.

**Supported platforms:**

* `x86_64-linux` (Linux x86\_64)
* `aarch64-linux` (Linux ARM64)
* `x86_64-darwin` (macOS Intel)
* `arm64-darwin` (macOS Apple Silicon)
* `x64-mingw-ucrt` (Windows x64)

**Sources:** [Gemfile.lock99-101](https://github.com/fs0414/rfmt/blob/90c575e6/Gemfile.lock#L99-L101)

### Manual Platform Gem Build

These commands:

1. Compile Rust code for the target platform
2. Package the native library with Ruby code
3. Create a `.gem` file in `pkg/` directory

**Sources:** [Gemfile.lock38-42](https://github.com/fs0414/rfmt/blob/90c575e6/Gemfile.lock#L38-L42)

### Cross-Compilation with rake-compiler-dock

For building gems for platforms other than your current system, use `rake-compiler-dock`:

This builds gems for all supported platforms using Docker containers with appropriate cross-compilation toolchains.

**Sources:** [Gemfile.lock40](https://github.com/fs0414/rfmt/blob/90c575e6/Gemfile.lock#L40-L40)

## Development Tools

### Quality Assurance Tools

**Sources:** [Gemfile.lock68-118](https://github.com/fs0414/rfmt/blob/90c575e6/Gemfile.lock#L68-L118) [.rubocop.yml1-96](https://github.com/fs0414/rfmt/blob/90c575e6/.rubocop.yml#L1-L96)

### Running Quality Checks

**Sources:** [.rubocop.yml1-6](https://github.com/fs0414/rfmt/blob/90c575e6/.rubocop.yml#L1-L6) [spec/spec\_helper.rb1-26](https://github.com/fs0414/rfmt/blob/90c575e6/spec/spec_helper.rb#L1-L26)

### Lefthook Configuration

Lefthook provides automated pre-commit and pre-push hooks:

**Sources:** [Gemfile.lock24](https://github.com/fs0414/rfmt/blob/90c575e6/Gemfile.lock#L24-L24)

## Development Dependencies

### Complete Dependency Map

**Sources:** [Gemfile.lock7-122](https://github.com/fs0414/rfmt/blob/90c575e6/Gemfile.lock#L7-L122)

## Troubleshooting

### Common Build Issues

| Issue | Cause | Solution |
| --- | --- | --- |
| `cargo: command not found` | Rust not installed | Install Rust via rustup |
| `rb_sys` build fails | Missing C compiler | Install gcc/clang/MSVC |
| `ruby.h: No such file` | Missing Ruby headers | Install `ruby-dev` package |
| `linking with cc failed` | Missing system libraries | Install `libssl-dev`, `pkg-config` |
| `cargo build` fails on Windows | Wrong Rust toolchain | Install `msvc` toolchain: `rustup default stable-msvc` |

### Verbose Build Output

For debugging build issues:

### Clean Build

To start from scratch:

## Verification

### Verify Successful Build

After compilation, verify the native extension loaded correctly:

### Build Artifacts

Successful build creates:

```
lib/rfmt/
  ├── rfmt.so          # Linux native extension
  └── (or rfmt.bundle) # macOS native extension

target/release/
  ├── librf fmt.so     # Rust compiled library
  └── ...              # Rust build artifacts
```

**Sources:** [rfmt.gemspec45-53](https://github.com/fs0414/rfmt/blob/90c575e6/rfmt.gemspec#L45-L53)

---

**Sources:** [rfmt.gemspec1-55](https://github.com/fs0414/rfmt/blob/90c575e6/rfmt.gemspec#L1-L55) [ext/rfmt/Cargo.toml1-60](https://github.com/fs0414/rfmt/blob/90c575e6/ext/rfmt/Cargo.toml#L1-L60) [Gemfile.lock1-122](https://github.com/fs0414/rfmt/blob/90c575e6/Gemfile.lock#L1-L122) [Cargo.lock1-1700](https://github.com/fs0414/rfmt/blob/90c575e6/Cargo.lock#L1-L1700) [.rubocop.yml1-96](https://github.com/fs0414/rfmt/blob/90c575e6/.rubocop.yml#L1-L96) [spec/spec\_helper.rb1-26](https://github.com/fs0414/rfmt/blob/90c575e6/spec/spec_helper.rb#L1-L26)

Dismiss

Refresh this wiki

Enter email to refresh

### On this page

* [Building from Source](https://deepwiki.com/fs0414/rfmt/6.1-building-from-source.html#building-from-source)
* [Overview](https://deepwiki.com/fs0414/rfmt/6.1-building-from-source.html#overview)
* [Prerequisites](https://deepwiki.com/fs0414/rfmt/6.1-building-from-source.html#prerequisites)
* [Required Software](https://deepwiki.com/fs0414/rfmt/6.1-building-from-source.html#required-software)
* [Platform-Specific Requirements](https://deepwiki.com/fs0414/rfmt/6.1-building-from-source.html#platform-specific-requirements)
* [Installing Dependencies](https://deepwiki.com/fs0414/rfmt/6.1-building-from-source.html#installing-dependencies)
* [Ruby Dependencies](https://deepwiki.com/fs0414/rfmt/6.1-building-from-source.html#ruby-dependencies)
* [Rust Toolchain Setup](https://deepwiki.com/fs0414/rfmt/6.1-building-from-source.html#rust-toolchain-setup)
* [Compilation Process](https://deepwiki.com/fs0414/rfmt/6.1-building-from-source.html#compilation-process)
* [Directory Structure](https://deepwiki.com/fs0414/rfmt/6.1-building-from-source.html#directory-structure)
* [Build Workflow](https://deepwiki.com/fs0414/rfmt/6.1-building-from-source.html#build-workflow)
* [Standard Build Command](https://deepwiki.com/fs0414/rfmt/6.1-building-from-source.html#standard-build-command)
* [Rust Dependencies](https://deepwiki.com/fs0414/rfmt/6.1-building-from-source.html#rust-dependencies)
* [Building Platform-Specific Gems](https://deepwiki.com/fs0414/rfmt/6.1-building-from-source.html#building-platform-specific-gems)
* [Native Gem Architecture](https://deepwiki.com/fs0414/rfmt/6.1-building-from-source.html#native-gem-architecture)
* [Manual Platform Gem Build](https://deepwiki.com/fs0414/rfmt/6.1-building-from-source.html#manual-platform-gem-build)
* [Cross-Compilation with rake-compiler-dock](https://deepwiki.com/fs0414/rfmt/6.1-building-from-source.html#cross-compilation-with-rake-compiler-dock)
* [Development Tools](https://deepwiki.com/fs0414/rfmt/6.1-building-from-source.html#development-tools)
* [Quality Assurance Tools](https://deepwiki.com/fs0414/rfmt/6.1-building-from-source.html#quality-assurance-tools)
* [Running Quality Checks](https://deepwiki.com/fs0414/rfmt/6.1-building-from-source.html#running-quality-checks)
* [Lefthook Configuration](https://deepwiki.com/fs0414/rfmt/6.1-building-from-source.html#lefthook-configuration)
* [Development Dependencies](https://deepwiki.com/fs0414/rfmt/6.1-building-from-source.html#development-dependencies)
* [Complete Dependency Map](https://deepwiki.com/fs0414/rfmt/6.1-building-from-source.html#complete-dependency-map)
* [Troubleshooting](https://deepwiki.com/fs0414/rfmt/6.1-building-from-source.html#troubleshooting)
* [Common Build Issues](https://deepwiki.com/fs0414/rfmt/6.1-building-from-source.html#common-build-issues)
* [Verbose Build Output](https://deepwiki.com/fs0414/rfmt/6.1-building-from-source.html#verbose-build-output)
* [Clean Build](https://deepwiki.com/fs0414/rfmt/6.1-building-from-source.html#clean-build)
* [Verification](https://deepwiki.com/fs0414/rfmt/6.1-building-from-source.html#verification)
* [Verify Successful Build](https://deepwiki.com/fs0414/rfmt/6.1-building-from-source.html#verify-successful-build)
* [Build Artifacts](https://deepwiki.com/fs0414/rfmt/6.1-building-from-source.html#build-artifacts)
