---
title: "Testing | fs0414/rfmt | DeepWiki"
source_url: "https://deepwiki.com/fs0414/rfmt/6.2-testing"
fetched_at: "2026-01-13T10:53:43.101777+00:00"
---



Loading...

Index your code with Devin

[DeepWiki](https://deepwiki.com/)

[DeepWiki](https://deepwiki.com/)

[fs0414/rfmt](https://github.com/fs0414/rfmt "Open repository")

Index your code with

Devin

Edit WikiShare

Loading...

Last indexed: 3 January 2026 ([90c575](https://github.com/fs0414/rfmt/commits/90c575e6))

* [Overview](https://deepwiki.com/fs0414/rfmt/1-overview.html)
* [Architecture Overview](https://deepwiki.com/fs0414/rfmt/1.1-architecture-overview.html)
* [Key Concepts](https://deepwiki.com/fs0414/rfmt/1.2-key-concepts.html)
* [Getting Started](https://deepwiki.com/fs0414/rfmt/2-getting-started.html)
* [Installation](https://deepwiki.com/fs0414/rfmt/2.1-installation.html)
* [Configuration](https://deepwiki.com/fs0414/rfmt/2.2-configuration.html)
* [User Guides](https://deepwiki.com/fs0414/rfmt/3-user-guides.html)
* [CLI Usage](https://deepwiki.com/fs0414/rfmt/3.1-cli-usage.html)
* [Ruby API](https://deepwiki.com/fs0414/rfmt/3.2-ruby-api.html)
* [Editor Integration](https://deepwiki.com/fs0414/rfmt/3.3-editor-integration.html)
* [Core Systems](https://deepwiki.com/fs0414/rfmt/4-core-systems.html)
* [AST Representation](https://deepwiki.com/fs0414/rfmt/4.1-ast-representation.html)
* [Formatting Engine (Emitter)](https://deepwiki.com/fs0414/rfmt/4.2-formatting-engine-(emitter).html)
* [Parser Integration (PrismBridge)](https://deepwiki.com/fs0414/rfmt/4.3-parser-integration-(prismbridge).html)
* [Configuration System](https://deepwiki.com/fs0414/rfmt/4.4-configuration-system.html)
* [Caching System](https://deepwiki.com/fs0414/rfmt/4.5-caching-system.html)
* [Logging System](https://deepwiki.com/fs0414/rfmt/4.6-logging-system.html)
* [Formatting Behavior](https://deepwiki.com/fs0414/rfmt/5-formatting-behavior.html)
* [Control Flow Formatting](https://deepwiki.com/fs0414/rfmt/5.1-control-flow-formatting.html)
* [Exception Handling Formatting](https://deepwiki.com/fs0414/rfmt/5.2-exception-handling-formatting.html)
* [Lambda and Block Formatting](https://deepwiki.com/fs0414/rfmt/5.3-lambda-and-block-formatting.html)
* [Development](https://deepwiki.com/fs0414/rfmt/6-development.html)
* [Building from Source](https://deepwiki.com/fs0414/rfmt/6.1-building-from-source.html)
* [Testing](https://deepwiki.com/fs0414/rfmt/6.2-testing.html)
* [Release Process](https://deepwiki.com/fs0414/rfmt/6.3-release-process.html)
* [Reference](https://deepwiki.com/fs0414/rfmt/7-reference.html)
* [Node Types Reference](https://deepwiki.com/fs0414/rfmt/7.1-node-types-reference.html)
* [Configuration Options Reference](https://deepwiki.com/fs0414/rfmt/7.2-configuration-options-reference.html)
* [Error Codes Reference](https://deepwiki.com/fs0414/rfmt/7.3-error-codes-reference.html)
* [Performance and Benchmarks](https://deepwiki.com/fs0414/rfmt/7.4-performance-and-benchmarks.html)

Menu

# Testing

Relevant source files

* [.rubocop.yml](https://github.com/fs0414/rfmt/blob/90c575e6/.rubocop.yml)
* [CHANGELOG.md](https://github.com/fs0414/rfmt/blob/90c575e6/CHANGELOG.md)
* [Gemfile.lock](https://github.com/fs0414/rfmt/blob/90c575e6/Gemfile.lock)
* [rfmt.gemspec](https://github.com/fs0414/rfmt/blob/90c575e6/rfmt.gemspec)
* [spec/case\_formatting\_spec.rb](https://github.com/fs0414/rfmt/blob/90c575e6/spec/case_formatting_spec.rb)
* [spec/conditional\_formatting\_spec.rb](https://github.com/fs0414/rfmt/blob/90c575e6/spec/conditional_formatting_spec.rb)
* [spec/config\_management\_spec.rb](https://github.com/fs0414/rfmt/blob/90c575e6/spec/config_management_spec.rb)
* [spec/rfmt\_spec.rb](https://github.com/fs0414/rfmt/blob/90c575e6/spec/rfmt_spec.rb)
* [spec/spec\_helper.rb](https://github.com/fs0414/rfmt/blob/90c575e6/spec/spec_helper.rb)

This page documents the testing infrastructure and practices for the rfmt codebase. It covers both the Ruby test suite (RSpec) and Rust test suite (cargo test), test organization, quality gates (RuboCop, clippy, Lefthook), and how to run and write tests.

For information about building the project before testing, see [Building from Source](https://deepwiki.com/fs0414/rfmt/6.1-building-from-source.html). For information about the release process and quality checks performed during release, see [Release Process](https://deepwiki.com/fs0414/rfmt/6.3-release-process.html).

---

## Test Architecture Overview

The rfmt testing strategy reflects the hybrid Ruby-Rust architecture, with separate test suites for each language layer and quality enforcement tools that ensure code standards across both.

**Sources:** [Gemfile.lock1-122](https://github.com/fs0414/rfmt/blob/90c575e6/Gemfile.lock#L1-L122) [spec/spec\_helper.rb1-27](https://github.com/fs0414/rfmt/blob/90c575e6/spec/spec_helper.rb#L1-L27) [.rubocop.yml1-96](https://github.com/fs0414/rfmt/blob/90c575e6/.rubocop.yml#L1-L96)

---

## Ruby Test Suite (RSpec)

The Ruby test suite uses RSpec 3.13+ and is organized into multiple spec files, each focusing on specific aspects of functionality. Tests are located in the `spec/` directory.

### Test Organization

Tests are categorized by functionality into separate spec files:

| Spec File | Purpose | Key Tests |
| --- | --- | --- |
| `rfmt_spec.rb` | Core formatting functionality | Basic formatting, Rails migrations, keyword parameters |
| `conditional_formatting_spec.rb` | Control flow formatting | if/elsif/else, unless, postfix conditionals, nested conditionals |
| `case_formatting_spec.rb` | Case statement formatting | case/when/else, nested case statements |
| `config_management_spec.rb` | Configuration API | Config.init, Config.load, Config.exists?, DEFAULT\_CONFIG validation |

**Sources:** [spec/rfmt\_spec.rb1-90](https://github.com/fs0414/rfmt/blob/90c575e6/spec/rfmt_spec.rb#L1-L90) [spec/conditional\_formatting\_spec.rb1-108](https://github.com/fs0414/rfmt/blob/90c575e6/spec/conditional_formatting_spec.rb#L1-L108) [spec/case\_formatting\_spec.rb1-23](https://github.com/fs0414/rfmt/blob/90c575e6/spec/case_formatting_spec.rb#L1-L23) [spec/config\_management\_spec.rb1-154](https://github.com/fs0414/rfmt/blob/90c575e6/spec/config_management_spec.rb#L1-L154)

### RSpec Configuration

The test suite is configured via `spec_helper.rb`, which sets up:

* **Example status persistence:** Enables `--only-failures` and `--next-failure` flags via `.rspec_status` file [spec/spec\_helper.rb11](https://github.com/fs0414/rfmt/blob/90c575e6/spec/spec_helper.rb#L11-L11)
* **Monkey patching disabled:** Uses explicit `RSpec` module calls instead of global methods [spec/spec\_helper.rb14](https://github.com/fs0414/rfmt/blob/90c575e6/spec/spec_helper.rb#L14-L14)
* **Directory management:** Saves and restores working directory after suite completes [spec/spec\_helper.rb6-25](https://github.com/fs0414/rfmt/blob/90c575e6/spec/spec_helper.rb#L6-L25)

**Sources:** [spec/spec\_helper.rb1-27](https://github.com/fs0414/rfmt/blob/90c575e6/spec/spec_helper.rb#L1-L27)

### Running Ruby Tests

Execute the Ruby test suite using standard RSpec commands:

**Sources:** [Gemfile.lock50-67](https://github.com/fs0414/rfmt/blob/90c575e6/Gemfile.lock#L50-L67)

### Key Test Patterns

#### Basic Formatting Tests

The core formatting tests in `rfmt_spec.rb` verify fundamental behavior:

These tests ensure that `Rfmt.format(source)` correctly transforms Ruby code and handles edge cases like Rails migrations with version numbers (e.g., `ActiveRecord::Migration[8.1]`) [spec/rfmt\_spec.rb32-46](https://github.com/fs0414/rfmt/blob/90c575e6/spec/rfmt_spec.rb#L32-L46)

**Sources:** [spec/rfmt\_spec.rb6-78](https://github.com/fs0414/rfmt/blob/90c575e6/spec/rfmt_spec.rb#L6-L78)

#### Conditional Formatting Tests

The conditional formatting specs verify control flow construct formatting with exact expected output:

Tests validate indentation correctness, postfix conditional preservation, and nested conditional handling [spec/conditional\_formatting\_spec.rb6-107](https://github.com/fs0414/rfmt/blob/90c575e6/spec/conditional_formatting_spec.rb#L6-L107)

**Sources:** [spec/conditional\_formatting\_spec.rb1-108](https://github.com/fs0414/rfmt/blob/90c575e6/spec/conditional_formatting_spec.rb#L1-L108)

#### Configuration Management Tests

Configuration tests verify the `Rfmt::Config` API behavior using temporary directories:

Tests cover file creation, overwrite protection, explicit path loading, and default config validation [spec/config\_management\_spec.rb9-153](https://github.com/fs0414/rfmt/blob/90c575e6/spec/config_management_spec.rb#L9-L153)

**Sources:** [spec/config\_management\_spec.rb1-154](https://github.com/fs0414/rfmt/blob/90c575e6/spec/config_management_spec.rb#L1-L154)

---

## Rust Test Suite

The Rust test suite uses cargo's built-in test framework. Tests are marked with `#[cfg(test)]` and `#[test]` attributes and are typically co-located with the code they test.

### Test Organization

Rust tests are organized within the source files:

* **Unit tests:** Located in `#[cfg(test)] mod tests` blocks within each module
* **Integration tests:** Could be added to `ext/rfmt/tests/` directory
* **Doc tests:** Embedded in documentation comments with `///` or `//!`

The CHANGELOG indicates that Rust test organization has evolved over time, with improvements to remove redundant tests [CHANGELOG.md170-171](https://github.com/fs0414/rfmt/blob/90c575e6/CHANGELOG.md#L170-L171)

**Sources:** [CHANGELOG.md169-178](https://github.com/fs0414/rfmt/blob/90c575e6/CHANGELOG.md#L169-L178)

### Running Rust Tests

Execute Rust tests using cargo commands:

The gemspec indicates that the Rust extension is compiled from `ext/rfmt/` [rfmt.gemspec36-47](https://github.com/fs0414/rfmt/blob/90c575e6/rfmt.gemspec#L36-L47)

**Sources:** [rfmt.gemspec36-55](https://github.com/fs0414/rfmt/blob/90c575e6/rfmt.gemspec#L36-L55)

---

## Quality Gates

Quality gates ensure code standards are maintained across both Ruby and Rust codebases. These checks are enforced manually, via CI/CD, and through Git hooks.

### RuboCop (Ruby Linting)

RuboCop enforces Ruby style guidelines configured in `.rubocop.yml`:

| Configuration | Setting | Purpose |
| --- | --- | --- |
| TargetRubyVersion | 3.0 | Minimum Ruby version support |
| NewCops | enabled | Automatically enable new cops |
| Layout/LineLength | 120 max | Line length limit |
| Metrics/BlockLength | 50 max (specs excluded) | Block size limit |
| Metrics/AbcSize | 20 max (some files excluded) | Assignment/Branch/Condition complexity |

Excluded paths include `vendor/`, `tmp/`, `pkg/`, and test fixtures [.rubocop.yml4-10](https://github.com/fs0414/rfmt/blob/90c575e6/.rubocop.yml#L4-L10)

**Running RuboCop:**

**Sources:** [.rubocop.yml1-96](https://github.com/fs0414/rfmt/blob/90c575e6/.rubocop.yml#L1-L96) [Gemfile.lock68-81](https://github.com/fs0414/rfmt/blob/90c575e6/Gemfile.lock#L68-L81)

### Cargo Tools (Rust Linting and Formatting)

Rust code quality is enforced through cargo tools:

#### cargo fmt (Formatting)

#### cargo clippy (Linting)

The CHANGELOG documents ongoing clippy warning resolution efforts [CHANGELOG.md152-154](https://github.com/fs0414/rfmt/blob/90c575e6/CHANGELOG.md#L152-L154)

**Sources:** [CHANGELOG.md151-178](https://github.com/fs0414/rfmt/blob/90c575e6/CHANGELOG.md#L151-L178)

### Lefthook (Git Hooks)

Lefthook automates quality checks as Git hooks, preventing low-quality code from being pushed. The configuration enforces all quality gates before push operations.

**Sources:** [Gemfile.lock24](https://github.com/fs0414/rfmt/blob/90c575e6/Gemfile.lock#L24-L24) [CHANGELOG.md93](https://github.com/fs0414/rfmt/blob/90c575e6/CHANGELOG.md#L93-L93)

---

## Test Dependencies

Test-related dependencies are managed through Bundler for Ruby and Cargo for Rust.

### Ruby Test Dependencies

| Dependency | Version | Purpose |
| --- | --- | --- |
| rspec | 3.13.2 | Core testing framework |
| rspec-benchmark | 0.6.0 | Performance benchmarking |
| simplecov | 0.22.0 | Code coverage reporting |
| diff-lcs | 1.6.2 | Text diff generation |
| diffy | 3.4.4 | Advanced diff output |
| rubocop | 1.81.7 | Ruby linting |
| lefthook | 1.13.6 | Git hook management |

Test dependencies are declared in `Gemfile` and locked in `Gemfile.lock` [Gemfile.lock50-119](https://github.com/fs0414/rfmt/blob/90c575e6/Gemfile.lock#L50-L119)

**Sources:** [Gemfile.lock1-122](https://github.com/fs0414/rfmt/blob/90c575e6/Gemfile.lock#L1-L122)

### Rust Test Dependencies

Rust test dependencies are managed through `Cargo.toml`. While not shown in the provided files, typical Rust test dependencies might include:

* Built-in `#[test]` framework (no external dependency)
* `assert_matches` for pattern matching in tests
* `pretty_assertions` for readable assertion failures

---

## Test Coverage

Test coverage is tracked using SimpleCov for the Ruby codebase:

Coverage reports are generated in the `coverage/` directory after running RSpec tests.

**Sources:** [Gemfile.lock87-92](https://github.com/fs0414/rfmt/blob/90c575e6/Gemfile.lock#L87-L92)

---

## Writing Tests

### Writing Ruby Tests

When adding new Ruby tests, follow these patterns:

**1. Basic formatting test structure:**

**2. Error handling tests:**

**3. Configuration tests with temp directories:**

**Sources:** [spec/rfmt\_spec.rb6-78](https://github.com/fs0414/rfmt/blob/90c575e6/spec/rfmt_spec.rb#L6-L78) [spec/conditional\_formatting\_spec.rb6-29](https://github.com/fs0414/rfmt/blob/90c575e6/spec/conditional_formatting_spec.rb#L6-L29) [spec/config\_management\_spec.rb10-53](https://github.com/fs0414/rfmt/blob/90c575e6/spec/config_management_spec.rb#L10-L53)

### Writing Rust Tests

When adding Rust tests, use the standard test module pattern:

The CHANGELOG notes that test-only code should use `#[cfg(test)]` attributes [CHANGELOG.md155](https://github.com/fs0414/rfmt/blob/90c575e6/CHANGELOG.md#L155-L155)

**Sources:** [CHANGELOG.md151-178](https://github.com/fs0414/rfmt/blob/90c575e6/CHANGELOG.md#L151-L178)

---

## Test Execution Workflow

**Sources:** [CHANGELOG.md93](https://github.com/fs0414/rfmt/blob/90c575e6/CHANGELOG.md#L93-L93) [Gemfile.lock24](https://github.com/fs0414/rfmt/blob/90c575e6/Gemfile.lock#L24-L24)

---

## Test Maintenance

### Consolidated Test Suite

The test suite has undergone significant consolidation over the project's lifetime. The CHANGELOG documents a major simplification in version 0.2.0:

> Simplified RSpec test suite (reduced from ~200 to 7 essential tests)
> Removed redundant and duplicate tests

This consolidation focused on maintaining comprehensive coverage while eliminating duplication [CHANGELOG.md169-171](https://github.com/fs0414/rfmt/blob/90c575e6/CHANGELOG.md#L169-L171)

### Test Evolution

As documented in the CHANGELOG, tests have evolved to cover new features:

* **v1.2.0:** Consolidated and simplified test suite [CHANGELOG.md30](https://github.com/fs0414/rfmt/blob/90c575e6/CHANGELOG.md#L30-L30)
* **v1.1.0:** Added tests for keyword parameter formatting [CHANGELOG.md44-47](https://github.com/fs0414/rfmt/blob/90c575e6/CHANGELOG.md#L44-L47)
* **v0.2.0:** Major test suite simplification [CHANGELOG.md169-171](https://github.com/fs0414/rfmt/blob/90c575e6/CHANGELOG.md#L169-L171)

**Sources:** [CHANGELOG.md1-182](https://github.com/fs0414/rfmt/blob/90c575e6/CHANGELOG.md#L1-L182)

---

## Summary

The rfmt testing infrastructure provides comprehensive coverage across both Ruby and Rust layers:

* **Ruby tests** use RSpec with organized spec files covering formatting behavior, configuration, and integration
* **Rust tests** use cargo's built-in framework with unit tests co-located with code
* **Quality gates** (RuboCop, clippy, cargo fmt) enforce code standards
* **Lefthook** automates quality checks as Git hooks before push
* **Test dependencies** are managed via Bundler (Ruby) and Cargo (Rust)
* **Test coverage** is tracked via SimpleCov for Ruby code

For information on the build process before testing, see [Building from Source](https://deepwiki.com/fs0414/rfmt/6.1-building-from-source.html). For information on the release process and final quality checks, see [Release Process](https://deepwiki.com/fs0414/rfmt/6.3-release-process.html).

Dismiss

Refresh this wiki

Enter email to refresh

### On this page

* [Testing](https://deepwiki.com/fs0414/rfmt/6.2-testing.html#testing)
* [Test Architecture Overview](https://deepwiki.com/fs0414/rfmt/6.2-testing.html#test-architecture-overview)
* [Ruby Test Suite (RSpec)](https://deepwiki.com/fs0414/rfmt/6.2-testing.html#ruby-test-suite-rspec)
* [Test Organization](https://deepwiki.com/fs0414/rfmt/6.2-testing.html#test-organization)
* [RSpec Configuration](https://deepwiki.com/fs0414/rfmt/6.2-testing.html#rspec-configuration)
* [Running Ruby Tests](https://deepwiki.com/fs0414/rfmt/6.2-testing.html#running-ruby-tests)
* [Key Test Patterns](https://deepwiki.com/fs0414/rfmt/6.2-testing.html#key-test-patterns)
* [Basic Formatting Tests](https://deepwiki.com/fs0414/rfmt/6.2-testing.html#basic-formatting-tests)
* [Conditional Formatting Tests](https://deepwiki.com/fs0414/rfmt/6.2-testing.html#conditional-formatting-tests)
* [Configuration Management Tests](https://deepwiki.com/fs0414/rfmt/6.2-testing.html#configuration-management-tests)
* [Rust Test Suite](https://deepwiki.com/fs0414/rfmt/6.2-testing.html#rust-test-suite)
* [Test Organization](https://deepwiki.com/fs0414/rfmt/6.2-testing.html#test-organization-1)
* [Running Rust Tests](https://deepwiki.com/fs0414/rfmt/6.2-testing.html#running-rust-tests)
* [Quality Gates](https://deepwiki.com/fs0414/rfmt/6.2-testing.html#quality-gates)
* [RuboCop (Ruby Linting)](https://deepwiki.com/fs0414/rfmt/6.2-testing.html#rubocop-ruby-linting)
* [Cargo Tools (Rust Linting and Formatting)](https://deepwiki.com/fs0414/rfmt/6.2-testing.html#cargo-tools-rust-linting-and-formatting)
* [cargo fmt (Formatting)](https://deepwiki.com/fs0414/rfmt/6.2-testing.html#cargo-fmt-formatting)
* [cargo clippy (Linting)](https://deepwiki.com/fs0414/rfmt/6.2-testing.html#cargo-clippy-linting)
* [Lefthook (Git Hooks)](https://deepwiki.com/fs0414/rfmt/6.2-testing.html#lefthook-git-hooks)
* [Test Dependencies](https://deepwiki.com/fs0414/rfmt/6.2-testing.html#test-dependencies)
* [Ruby Test Dependencies](https://deepwiki.com/fs0414/rfmt/6.2-testing.html#ruby-test-dependencies)
* [Rust Test Dependencies](https://deepwiki.com/fs0414/rfmt/6.2-testing.html#rust-test-dependencies)
* [Test Coverage](https://deepwiki.com/fs0414/rfmt/6.2-testing.html#test-coverage)
* [Writing Tests](https://deepwiki.com/fs0414/rfmt/6.2-testing.html#writing-tests)
* [Writing Ruby Tests](https://deepwiki.com/fs0414/rfmt/6.2-testing.html#writing-ruby-tests)
* [Writing Rust Tests](https://deepwiki.com/fs0414/rfmt/6.2-testing.html#writing-rust-tests)
* [Test Execution Workflow](https://deepwiki.com/fs0414/rfmt/6.2-testing.html#test-execution-workflow)
* [Test Maintenance](https://deepwiki.com/fs0414/rfmt/6.2-testing.html#test-maintenance)
* [Consolidated Test Suite](https://deepwiki.com/fs0414/rfmt/6.2-testing.html#consolidated-test-suite)
* [Test Evolution](https://deepwiki.com/fs0414/rfmt/6.2-testing.html#test-evolution)
* [Summary](https://deepwiki.com/fs0414/rfmt/6.2-testing.html#summary)
