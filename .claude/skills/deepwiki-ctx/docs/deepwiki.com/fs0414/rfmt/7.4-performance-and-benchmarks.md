---
title: "Performance and Benchmarks | fs0414/rfmt | DeepWiki"
source_url: "https://deepwiki.com/fs0414/rfmt/7.4-performance-and-benchmarks"
fetched_at: "2026-01-13T10:53:43.101777+00:00"
---



Loading...

Index your code with Devin

[DeepWiki](https://deepwiki.com/)

[DeepWiki](https://deepwiki.com/)

[fs0414/rfmt](https://github.com/fs0414/rfmt "Open repository")

Index your code with

Devin

Edit WikiShare

Loading...

Last indexed: 3 January 2026 ([90c575](https://github.com/fs0414/rfmt/commits/90c575e6))

* [Overview](https://deepwiki.com/fs0414/rfmt/1-overview.html)
* [Architecture Overview](https://deepwiki.com/fs0414/rfmt/1.1-architecture-overview.html)
* [Key Concepts](https://deepwiki.com/fs0414/rfmt/1.2-key-concepts.html)
* [Getting Started](https://deepwiki.com/fs0414/rfmt/2-getting-started.html)
* [Installation](https://deepwiki.com/fs0414/rfmt/2.1-installation.html)
* [Configuration](https://deepwiki.com/fs0414/rfmt/2.2-configuration.html)
* [User Guides](https://deepwiki.com/fs0414/rfmt/3-user-guides.html)
* [CLI Usage](https://deepwiki.com/fs0414/rfmt/3.1-cli-usage.html)
* [Ruby API](https://deepwiki.com/fs0414/rfmt/3.2-ruby-api.html)
* [Editor Integration](https://deepwiki.com/fs0414/rfmt/3.3-editor-integration.html)
* [Core Systems](https://deepwiki.com/fs0414/rfmt/4-core-systems.html)
* [AST Representation](https://deepwiki.com/fs0414/rfmt/4.1-ast-representation.html)
* [Formatting Engine (Emitter)](https://deepwiki.com/fs0414/rfmt/4.2-formatting-engine-(emitter).html)
* [Parser Integration (PrismBridge)](https://deepwiki.com/fs0414/rfmt/4.3-parser-integration-(prismbridge).html)
* [Configuration System](https://deepwiki.com/fs0414/rfmt/4.4-configuration-system.html)
* [Caching System](https://deepwiki.com/fs0414/rfmt/4.5-caching-system.html)
* [Logging System](https://deepwiki.com/fs0414/rfmt/4.6-logging-system.html)
* [Formatting Behavior](https://deepwiki.com/fs0414/rfmt/5-formatting-behavior.html)
* [Control Flow Formatting](https://deepwiki.com/fs0414/rfmt/5.1-control-flow-formatting.html)
* [Exception Handling Formatting](https://deepwiki.com/fs0414/rfmt/5.2-exception-handling-formatting.html)
* [Lambda and Block Formatting](https://deepwiki.com/fs0414/rfmt/5.3-lambda-and-block-formatting.html)
* [Development](https://deepwiki.com/fs0414/rfmt/6-development.html)
* [Building from Source](https://deepwiki.com/fs0414/rfmt/6.1-building-from-source.html)
* [Testing](https://deepwiki.com/fs0414/rfmt/6.2-testing.html)
* [Release Process](https://deepwiki.com/fs0414/rfmt/6.3-release-process.html)
* [Reference](https://deepwiki.com/fs0414/rfmt/7-reference.html)
* [Node Types Reference](https://deepwiki.com/fs0414/rfmt/7.1-node-types-reference.html)
* [Configuration Options Reference](https://deepwiki.com/fs0414/rfmt/7.2-configuration-options-reference.html)
* [Error Codes Reference](https://deepwiki.com/fs0414/rfmt/7.3-error-codes-reference.html)
* [Performance and Benchmarks](https://deepwiki.com/fs0414/rfmt/7.4-performance-and-benchmarks.html)

Menu

# Performance and Benchmarks

Relevant source files

* [CHANGELOG.md](https://github.com/fs0414/rfmt/blob/90c575e6/CHANGELOG.md)
* [Gemfile.lock](https://github.com/fs0414/rfmt/blob/90c575e6/Gemfile.lock)
* [README.md](https://github.com/fs0414/rfmt/blob/90c575e6/README.md)
* [exe/rfmt](https://github.com/fs0414/rfmt/blob/90c575e6/exe/rfmt)
* [lib/rfmt/cli.rb](https://github.com/fs0414/rfmt/blob/90c575e6/lib/rfmt/cli.rb)
* [lib/rfmt/configuration.rb](https://github.com/fs0414/rfmt/blob/90c575e6/lib/rfmt/configuration.rb)
* [spec/cli\_spec.rb](https://github.com/fs0414/rfmt/blob/90c575e6/spec/cli_spec.rb)

**Purpose**: This document describes rfmt's performance characteristics, provides benchmark data comparing rfmt with RuboCop, explains the architectural decisions that enable high performance, and offers guidance on optimizing rfmt usage. For configuration options that affect performance, see [Configuration Options Reference](https://deepwiki.com/fs0414/rfmt/7.2-configuration-options-reference.html).

## Performance Characteristics

rfmt exhibits distinctive performance characteristics that differentiate it from traditional Ruby-based formatters:

| Characteristic | Value | Observation |
| --- | --- | --- |
| **Execution Time** | 172-191ms | Near-constant regardless of file count |
| **Variance** | 8-23ms std dev | Low variance across runs |
| **Startup Overhead** | ~150ms | Ruby VM + FFI initialization |
| **Per-File Overhead** | ~1-5ms | Minimal incremental cost |

The near-constant execution time occurs because the majority of time is spent in startup overhead (Ruby VM initialization, FFI bridge setup, configuration loading), while the actual formatting cost per file is minimal due to the Rust-based formatting engine.

**Sources**: [README.md49-75](https://github.com/fs0414/rfmt/blob/90c575e6/README.md#L49-L75)

## Benchmark Data

### Comparison with RuboCop

The following benchmarks were conducted on a Rails project containing 111 files with 3,241 lines of code:

| Test Type | File Count | rfmt Time | RuboCop Time | Performance Ratio |
| --- | --- | --- | --- | --- |
| Single File | 1 | 191ms | 1.38s | **7.2x faster** |
| Directory | 14 | 176ms | 1.68s | **9.6x faster** |
| Full Project (check mode) | 111 | 172ms | 4.36s | **25.4x faster** |

**Key Observations**:

* rfmt execution time remains nearly constant (172-191ms) regardless of file count
* RuboCop execution time scales with the number of files
* The performance advantage increases with project size
* All measurements are averages from 10 runs per test

**Test Environment**:

* **CPU**: Apple Silicon (arm64)
* **Ruby**: 3.4.5
* **rfmt**: 0.3.0
* **RuboCop**: 1.81.7
* **Mode**: Check mode (no file modifications)

**Sources**: [README.md49-75](https://github.com/fs0414/rfmt/blob/90c575e6/README.md#L49-L75)

### Methodology Constraints

The benchmark comparison requires context to interpret accurately:

1. **RuboCop includes linting**: RuboCop times include loading all linting rules (cops), AST analysis for code quality checks, and style enforcement
2. **Default configuration**: RuboCop was run with default configuration (all cops enabled)
3. **rfmt is formatting-only**: rfmt performs no code quality analysis or linting
4. **Check mode**: Both tools were measured in check mode to avoid disk I/O variance

This comparison demonstrates the performance benefit of a focused, formatting-only tool but does not imply RuboCop is slow for its intended purpose (comprehensive linting + formatting).

**Sources**: [README.md59-65](https://github.com/fs0414/rfmt/blob/90c575e6/README.md#L59-L65)

## Architecture-Driven Performance

### Hybrid Ruby-Rust Architecture

**Sources**: [README.md36-48](https://github.com/fs0414/rfmt/blob/90c575e6/README.md#L36-L48) [lib/rfmt/cli.rb96-100](https://github.com/fs0414/rfmt/blob/90c575e6/lib/rfmt/cli.rb#L96-L100)

### Performance Advantage Breakdown

The performance characteristics derive from architectural decisions:

#### 1. Rust Formatting Core

The `Emitter` in Rust operates with minimal overhead:

* **Native code execution**: No Ruby VM interpretation overhead
* **Memory efficiency**: Rust's ownership model prevents unnecessary allocations
* **Type safety**: Static dispatch eliminates runtime type checks

The formatting engine resides in [ext/rfmt/src/emitter/mod.rs](https://github.com/fs0414/rfmt/blob/90c575e6/ext/rfmt/src/emitter/mod.rs) implementing specialized formatting logic without Ruby's dynamic dispatch overhead.

#### 2. Minimal FFI Overhead

The FFI boundary imposes a fixed cost per invocation:

* **JSON serialization**: AST serialized once per file (~5-10ms)
* **String copying**: Formatted output copied back to Ruby
* **No repeated crossings**: Single FFI call per file

The `PrismBridge` handles FFI communication in [lib/rfmt/prism\_bridge.rb](https://github.com/fs0414/rfmt/blob/90c575e6/lib/rfmt/prism_bridge.rb) serializing the AST to JSON and invoking Rust through Magnus.

#### 3. No Linting Analysis

rfmt performs only formatting, avoiding:

* **Rule evaluation**: No need to check multiple linting rules
* **Pattern matching**: No AST traversal for code quality patterns
* **Complexity analysis**: No cyclomatic complexity or nesting checks

This focused approach eliminates the majority of RuboCop's processing time.

**Sources**: [README.md359-369](https://github.com/fs0414/rfmt/blob/90c575e6/README.md#L359-L369)

## Performance Optimization Features

### Caching System

The cache system provides significant performance benefits for unchanged files:

**Cache Storage**: [~/.cache/rfmt/cache.json](https://github.com/fs0414/rfmt/blob/90c575e6/~/.cache/rfmt/cache.json)
**Implementation**: [lib/rfmt/cache.rb](https://github.com/fs0414/rfmt/blob/90c575e6/lib/rfmt/cache.rb)
**Hash Algorithm**: SHA256 (via OpenSSL::Digest)

**Cache Operations**:

* `Cache.needs_formatting?(file)`: Compares file hash with cached value
* `Cache.mark_formatted(file)`: Updates cache with new hash
* `Cache.save`: Persists cache to disk (JSON format)
* `Cache.prune`: Removes stale entries for deleted files

**Performance Impact**:

* Cache hit: ~1ms (hash computation + lookup)
* Cache miss: Full formatting (~15-30ms per file)
* Typical cache hit rate: 90%+ in iterative development

**Cache Management**:

**Sources**: [lib/rfmt/cli.rb71-86](https://github.com/fs0414/rfmt/blob/90c575e6/lib/rfmt/cli.rb#L71-L86) [lib/rfmt/cache.rb](https://github.com/fs0414/rfmt/blob/90c575e6/lib/rfmt/cache.rb)

### Parallel Processing

Parallel processing amortizes startup overhead across multiple CPU cores:

**Implementation**: Uses the `parallel` gem with process-based parallelism
**Configuration**: [lib/rfmt/cli.rb96-100](https://github.com/fs0414/rfmt/blob/90c575e6/lib/rfmt/cli.rb#L96-L100)
**Process Count**: Defaults to `Parallel.processor_count` (CPU core count)

**Parallel Processing Strategy**:

**Performance Characteristics**:

* **Single file**: No benefit (overhead > gain)
* **2-10 files**: 1.5-2x speedup
* **10-100 files**: 2-3x speedup
* **100+ files**: 3-4x speedup (diminishing returns)

**Process-based vs Thread-based**:

* rfmt uses process-based parallelism (`in_processes:` option)
* Avoids Ruby GVL (Global VM Lock) limitations
* Each process has independent Ruby VM and Rust FFI
* Higher memory overhead (~50MB per process) but true parallelism

**Sources**: [lib/rfmt/cli.rb157-168](https://github.com/fs0414/rfmt/blob/90c575e6/lib/rfmt/cli.rb#L157-L168) [Gemfile.lock27](https://github.com/fs0414/rfmt/blob/90c575e6/Gemfile.lock#L27-L27)

### File Filtering

Early file filtering reduces unnecessary work:

**Include/Exclude Patterns**:

**Implementation**: [lib/rfmt/configuration.rb36-44](https://github.com/fs0414/rfmt/blob/90c575e6/lib/rfmt/configuration.rb#L36-L44)

**Performance Impact**:

* Glob matching: ~1-5ms for typical projects
* Prevents formatting of thousands of vendored files
* Reduces cache size and lookup time

**Sources**: [lib/rfmt/configuration.rb36-44](https://github.com/fs0414/rfmt/blob/90c575e6/lib/rfmt/configuration.rb#L36-L44)

## Benchmark Test Harness

rfmt includes benchmark testing infrastructure using the `rspec-benchmark` gem:

### Benchmark Dependencies

The `rspec-benchmark` gem provides:

* `benchmark-malloc`: Memory allocation tracking
* `benchmark-perf`: Performance counter access
* `benchmark-trend`: Statistical trend analysis

**Sources**: [Gemfile.lock54-58](https://github.com/fs0414/rfmt/blob/90c575e6/Gemfile.lock#L54-L58)

### Running Benchmarks

While specific benchmark test files are not included in the provided source, the test infrastructure supports:

The benchmark infrastructure enables:

* **Memory profiling**: Track allocations during formatting
* **Performance regression detection**: Identify performance degradation
* **Statistical analysis**: Verify performance claims with statistical confidence

**Sources**: [Gemfile.lock54-58](https://github.com/fs0414/rfmt/blob/90c575e6/Gemfile.lock#L54-L58) [README.md344](https://github.com/fs0414/rfmt/blob/90c575e6/README.md#L344-L344)

## Performance Tips

### 1. Enable Caching

Caching provides the largest performance improvement for iterative workflows:

**Best Practice**: Keep cache enabled in development. Clear cache only when debugging formatting issues.

**Sources**: [lib/rfmt/cli.rb59-74](https://github.com/fs0414/rfmt/blob/90c575e6/lib/rfmt/cli.rb#L59-L74)

### 2. Use Parallel Processing

For projects with 10+ files, parallel processing provides significant speedup:

**Best Practice**: Use default parallel processing for normal workflows. Disable only for debugging (`--no-parallel`).

**Sources**: [lib/rfmt/cli.rb57-58](https://github.com/fs0414/rfmt/blob/90c575e6/lib/rfmt/cli.rb#L57-L58)

### 3. Optimize Include/Exclude Patterns

Minimize file system traversal by excluding large directories:

**Performance Impact**: Excluding 10,000 files saves ~50-100ms in glob matching.

**Sources**: [lib/rfmt/configuration.rb10-19](https://github.com/fs0414/rfmt/blob/90c575e6/lib/rfmt/configuration.rb#L10-L19)

### 4. Use Check Mode in CI/CD

Check mode (`--check`) avoids write operations and provides fast validation:

**Performance**: Check mode is ~10-20ms faster per file (no disk write).

**Sources**: [lib/rfmt/cli.rb104-107](https://github.com/fs0414/rfmt/blob/90c575e6/lib/rfmt/cli.rb#L104-L107)

### 5. Minimize Configuration Complexity

Configuration discovery has overhead:

**Performance Impact**: Configuration discovery adds ~5-10ms (negligible for most use cases).

**Sources**: [lib/rfmt/cli.rb143-149](https://github.com/fs0414/rfmt/blob/90c575e6/lib/rfmt/cli.rb#L143-L149)

## Performance Monitoring

### CLI Verbose Mode

Enable verbose output to monitor performance:

**Verbose Output Includes**:

* File count and processing mode
* Parallel job count
* Cache hits/misses
* Per-file formatting status
* Total processing time

**Sources**: [lib/rfmt/cli.rb48](https://github.com/fs0414/rfmt/blob/90c575e6/lib/rfmt/cli.rb#L48-L48)

### Cache Statistics

Monitor cache effectiveness:

**Output**:

```
Cache directory: ~/.cache/rfmt
Total files in cache: 156
Cache size: 23.45 KB
```

**Interpretation**:

* High file count indicates effective caching
* Cache size should be ~150-200 bytes per file
* Prune cache if size exceeds 1MB (indicates stale entries)

**Sources**: [lib/rfmt/cli.rb24-33](https://github.com/fs0414/rfmt/blob/90c575e6/lib/rfmt/cli.rb#L24-L33)

### Exit Codes for Automation

Use exit codes to detect performance issues in scripts:

| Exit Code | Meaning | Use Case |
| --- | --- | --- |
| 0 | All files formatted | Success indicator |
| 1 | Errors occurred | CI/CD failure |
| 130 | Interrupted (Ctrl+C) | User cancellation |

**Sources**: [lib/rfmt/cli.rb256](https://github.com/fs0414/rfmt/blob/90c575e6/lib/rfmt/cli.rb#L256-L256) [exe/rfmt14-16](https://github.com/fs0414/rfmt/blob/90c575e6/exe/rfmt#L14-L16)

## Performance Limitations

### Known Bottlenecks

1. **Startup Overhead**: ~150ms fixed cost

   * Cannot be eliminated (Ruby VM + FFI initialization)
   * Mitigated by parallel processing for large projects
2. **FFI Serialization**: ~5-10ms per file

   * JSON serialization of AST
   * Acceptable tradeoff for Rust performance gains
3. **Single-File Processing**: Limited benefit over RuboCop

   * Startup overhead dominates for 1-2 files
   * Performance advantage appears at 10+ files

**Sources**: [README.md68-69](https://github.com/fs0414/rfmt/blob/90c575e6/README.md#L68-L69)

### Scaling Characteristics

**Observation**: Execution time remains nearly constant due to:

* Dominant startup overhead (~150ms)
* Minimal per-file cost (~1-5ms)
* Parallel processing amortization
* Effective caching

**Sources**: [README.md66-69](https://github.com/fs0414/rfmt/blob/90c575e6/README.md#L66-L69)

Dismiss

Refresh this wiki

Enter email to refresh

### On this page

* [Performance and Benchmarks](https://deepwiki.com/fs0414/rfmt/7.4-performance-and-benchmarks.html#performance-and-benchmarks)
* [Performance Characteristics](https://deepwiki.com/fs0414/rfmt/7.4-performance-and-benchmarks.html#performance-characteristics)
* [Benchmark Data](https://deepwiki.com/fs0414/rfmt/7.4-performance-and-benchmarks.html#benchmark-data)
* [Comparison with RuboCop](https://deepwiki.com/fs0414/rfmt/7.4-performance-and-benchmarks.html#comparison-with-rubocop)
* [Methodology Constraints](https://deepwiki.com/fs0414/rfmt/7.4-performance-and-benchmarks.html#methodology-constraints)
* [Architecture-Driven Performance](https://deepwiki.com/fs0414/rfmt/7.4-performance-and-benchmarks.html#architecture-driven-performance)
* [Hybrid Ruby-Rust Architecture](https://deepwiki.com/fs0414/rfmt/7.4-performance-and-benchmarks.html#hybrid-ruby-rust-architecture)
* [Performance Advantage Breakdown](https://deepwiki.com/fs0414/rfmt/7.4-performance-and-benchmarks.html#performance-advantage-breakdown)
* [1. Rust Formatting Core](https://deepwiki.com/fs0414/rfmt/7.4-performance-and-benchmarks.html#1-rust-formatting-core)
* [2. Minimal FFI Overhead](https://deepwiki.com/fs0414/rfmt/7.4-performance-and-benchmarks.html#2-minimal-ffi-overhead)
* [3. No Linting Analysis](https://deepwiki.com/fs0414/rfmt/7.4-performance-and-benchmarks.html#3-no-linting-analysis)
* [Performance Optimization Features](https://deepwiki.com/fs0414/rfmt/7.4-performance-and-benchmarks.html#performance-optimization-features)
* [Caching System](https://deepwiki.com/fs0414/rfmt/7.4-performance-and-benchmarks.html#caching-system)
* [Parallel Processing](https://deepwiki.com/fs0414/rfmt/7.4-performance-and-benchmarks.html#parallel-processing)
* [File Filtering](https://deepwiki.com/fs0414/rfmt/7.4-performance-and-benchmarks.html#file-filtering)
* [Benchmark Test Harness](https://deepwiki.com/fs0414/rfmt/7.4-performance-and-benchmarks.html#benchmark-test-harness)
* [Benchmark Dependencies](https://deepwiki.com/fs0414/rfmt/7.4-performance-and-benchmarks.html#benchmark-dependencies)
* [Running Benchmarks](https://deepwiki.com/fs0414/rfmt/7.4-performance-and-benchmarks.html#running-benchmarks)
* [Performance Tips](https://deepwiki.com/fs0414/rfmt/7.4-performance-and-benchmarks.html#performance-tips)
* [1. Enable Caching](https://deepwiki.com/fs0414/rfmt/7.4-performance-and-benchmarks.html#1-enable-caching)
* [2. Use Parallel Processing](https://deepwiki.com/fs0414/rfmt/7.4-performance-and-benchmarks.html#2-use-parallel-processing)
* [3. Optimize Include/Exclude Patterns](https://deepwiki.com/fs0414/rfmt/7.4-performance-and-benchmarks.html#3-optimize-includeexclude-patterns)
* [4. Use Check Mode in CI/CD](https://deepwiki.com/fs0414/rfmt/7.4-performance-and-benchmarks.html#4-use-check-mode-in-cicd)
* [5. Minimize Configuration Complexity](https://deepwiki.com/fs0414/rfmt/7.4-performance-and-benchmarks.html#5-minimize-configuration-complexity)
* [Performance Monitoring](https://deepwiki.com/fs0414/rfmt/7.4-performance-and-benchmarks.html#performance-monitoring)
* [CLI Verbose Mode](https://deepwiki.com/fs0414/rfmt/7.4-performance-and-benchmarks.html#cli-verbose-mode)
* [Cache Statistics](https://deepwiki.com/fs0414/rfmt/7.4-performance-and-benchmarks.html#cache-statistics)
* [Exit Codes for Automation](https://deepwiki.com/fs0414/rfmt/7.4-performance-and-benchmarks.html#exit-codes-for-automation)
* [Performance Limitations](https://deepwiki.com/fs0414/rfmt/7.4-performance-and-benchmarks.html#performance-limitations)
* [Known Bottlenecks](https://deepwiki.com/fs0414/rfmt/7.4-performance-and-benchmarks.html#known-bottlenecks)
* [Scaling Characteristics](https://deepwiki.com/fs0414/rfmt/7.4-performance-and-benchmarks.html#scaling-characteristics)
