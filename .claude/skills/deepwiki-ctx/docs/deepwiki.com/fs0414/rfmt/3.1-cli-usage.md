---
title: "CLI Usage | fs0414/rfmt | DeepWiki"
source_url: "https://deepwiki.com/fs0414/rfmt/3.1-cli-usage"
fetched_at: "2026-01-13T10:53:43.101777+00:00"
---



Loading...

Index your code with Devin

[DeepWiki](https://deepwiki.com/)

[DeepWiki](https://deepwiki.com/)

[fs0414/rfmt](https://github.com/fs0414/rfmt "Open repository")

Index your code with

Devin

Edit WikiShare

Loading...

Last indexed: 3 January 2026 ([90c575](https://github.com/fs0414/rfmt/commits/90c575e6))

* [Overview](https://deepwiki.com/fs0414/rfmt/1-overview.html)
* [Architecture Overview](https://deepwiki.com/fs0414/rfmt/1.1-architecture-overview.html)
* [Key Concepts](https://deepwiki.com/fs0414/rfmt/1.2-key-concepts.html)
* [Getting Started](https://deepwiki.com/fs0414/rfmt/2-getting-started.html)
* [Installation](https://deepwiki.com/fs0414/rfmt/2.1-installation.html)
* [Configuration](https://deepwiki.com/fs0414/rfmt/2.2-configuration.html)
* [User Guides](https://deepwiki.com/fs0414/rfmt/3-user-guides.html)
* [CLI Usage](https://deepwiki.com/fs0414/rfmt/3.1-cli-usage.html)
* [Ruby API](https://deepwiki.com/fs0414/rfmt/3.2-ruby-api.html)
* [Editor Integration](https://deepwiki.com/fs0414/rfmt/3.3-editor-integration.html)
* [Core Systems](https://deepwiki.com/fs0414/rfmt/4-core-systems.html)
* [AST Representation](https://deepwiki.com/fs0414/rfmt/4.1-ast-representation.html)
* [Formatting Engine (Emitter)](https://deepwiki.com/fs0414/rfmt/4.2-formatting-engine-(emitter).html)
* [Parser Integration (PrismBridge)](https://deepwiki.com/fs0414/rfmt/4.3-parser-integration-(prismbridge).html)
* [Configuration System](https://deepwiki.com/fs0414/rfmt/4.4-configuration-system.html)
* [Caching System](https://deepwiki.com/fs0414/rfmt/4.5-caching-system.html)
* [Logging System](https://deepwiki.com/fs0414/rfmt/4.6-logging-system.html)
* [Formatting Behavior](https://deepwiki.com/fs0414/rfmt/5-formatting-behavior.html)
* [Control Flow Formatting](https://deepwiki.com/fs0414/rfmt/5.1-control-flow-formatting.html)
* [Exception Handling Formatting](https://deepwiki.com/fs0414/rfmt/5.2-exception-handling-formatting.html)
* [Lambda and Block Formatting](https://deepwiki.com/fs0414/rfmt/5.3-lambda-and-block-formatting.html)
* [Development](https://deepwiki.com/fs0414/rfmt/6-development.html)
* [Building from Source](https://deepwiki.com/fs0414/rfmt/6.1-building-from-source.html)
* [Testing](https://deepwiki.com/fs0414/rfmt/6.2-testing.html)
* [Release Process](https://deepwiki.com/fs0414/rfmt/6.3-release-process.html)
* [Reference](https://deepwiki.com/fs0414/rfmt/7-reference.html)
* [Node Types Reference](https://deepwiki.com/fs0414/rfmt/7.1-node-types-reference.html)
* [Configuration Options Reference](https://deepwiki.com/fs0414/rfmt/7.2-configuration-options-reference.html)
* [Error Codes Reference](https://deepwiki.com/fs0414/rfmt/7.3-error-codes-reference.html)
* [Performance and Benchmarks](https://deepwiki.com/fs0414/rfmt/7.4-performance-and-benchmarks.html)

Menu

# CLI Usage

Relevant source files

* [README.md](https://github.com/fs0414/rfmt/blob/90c575e6/README.md)
* [docs/user\_guide.ja.md](https://github.com/fs0414/rfmt/blob/90c575e6/docs/user_guide.ja.md)
* [docs/user\_guide.md](https://github.com/fs0414/rfmt/blob/90c575e6/docs/user_guide.md)
* [exe/rfmt](https://github.com/fs0414/rfmt/blob/90c575e6/exe/rfmt)
* [lib/rfmt/cli.rb](https://github.com/fs0414/rfmt/blob/90c575e6/lib/rfmt/cli.rb)
* [lib/rfmt/configuration.rb](https://github.com/fs0414/rfmt/blob/90c575e6/lib/rfmt/configuration.rb)
* [spec/cli\_spec.rb](https://github.com/fs0414/rfmt/blob/90c575e6/spec/cli_spec.rb)

This page documents the command-line interface (CLI) for `rfmt`, including all available commands, options, exit codes, and common usage workflows. The CLI is the primary interface for formatting Ruby files in development and CI/CD environments.

For programmatic integration, see [Ruby API](https://deepwiki.com/fs0414/rfmt/3.2-ruby-api.html). For editor integration, see [Editor Integration](https://deepwiki.com/fs0414/rfmt/3.3-editor-integration.html). For configuration file details, see [Configuration](https://deepwiki.com/fs0414/rfmt/2.2-configuration.html).

---

## Overview

The `rfmt` CLI is implemented through the executable [exe/rfmt1-21](https://github.com/fs0414/rfmt/blob/90c575e6/exe/rfmt#L1-L21) which dispatches to the `Rfmt::CLI` class defined in [lib/rfmt/cli.rb46-308](https://github.com/fs0414/rfmt/blob/90c575e6/lib/rfmt/cli.rb#L46-L308) The CLI uses the Thor framework for command parsing and supports multiple commands with rich option handling.

**Sources:** [exe/rfmt1-21](https://github.com/fs0414/rfmt/blob/90c575e6/exe/rfmt#L1-L21) [lib/rfmt/cli.rb46-308](https://github.com/fs0414/rfmt/blob/90c575e6/lib/rfmt/cli.rb#L46-L308)

---

## Command Architecture

**Sources:** [exe/rfmt1-21](https://github.com/fs0414/rfmt/blob/90c575e6/exe/rfmt#L1-L21) [lib/rfmt/cli.rb46-308](https://github.com/fs0414/rfmt/blob/90c575e6/lib/rfmt/cli.rb#L46-L308) [lib/rfmt/configuration.rb1-96](https://github.com/fs0414/rfmt/blob/90c575e6/lib/rfmt/configuration.rb#L1-L96)

---

## Commands

### format [FILES...]

The default command that formats Ruby files. If no subcommand is specified, `format` is automatically prepended [exe/rfmt10](https://github.com/fs0414/rfmt/blob/90c575e6/exe/rfmt#L10-L10)

**Syntax:**

**Options:**

| Option | Type | Default | Description |
| --- | --- | --- | --- |
| `--write` | boolean | `true` | Write formatted output to files |
| `--check` | boolean | `false` | Check if files need formatting without writing |
| `--diff` | boolean | `false` | Show diff of changes |
| `--diff-format` | string | `unified` | Diff format: `unified`, `side_by_side`, or `color` |
| `--parallel` | boolean | `true` | Process files in parallel |
| `--jobs` | numeric | CPU count | Number of parallel jobs |
| `--cache` | boolean | `true` | Use cache to skip unchanged files |
| `--cache-dir` | string | `~/.cache/rfmt` | Custom cache directory |

**Examples:**

**Implementation:** [lib/rfmt/cli.rb52-102](https://github.com/fs0414/rfmt/blob/90c575e6/lib/rfmt/cli.rb#L52-L102)

**Sources:** [lib/rfmt/cli.rb52-102](https://github.com/fs0414/rfmt/blob/90c575e6/lib/rfmt/cli.rb#L52-L102) [README.md156-187](https://github.com/fs0414/rfmt/blob/90c575e6/README.md#L156-L187) [docs/user\_guide.md44-84](https://github.com/fs0414/rfmt/blob/90c575e6/docs/user_guide.md#L44-L84)

---

### check [FILES...]

Alias for `rfmt format --check`. Verifies if files need formatting without modifying them. Exits with code `2` if any files need formatting, making it suitable for CI/CD pipelines.

**Syntax:**

**Examples:**

**Implementation:** [lib/rfmt/cli.rb104-107](https://github.com/fs0414/rfmt/blob/90c575e6/lib/rfmt/cli.rb#L104-L107)

**Sources:** [lib/rfmt/cli.rb104-107](https://github.com/fs0414/rfmt/blob/90c575e6/lib/rfmt/cli.rb#L104-L107) [README.md169-173](https://github.com/fs0414/rfmt/blob/90c575e6/README.md#L169-L173)

---

### version

Displays version information for both the Ruby gem and the Rust extension.

**Syntax:**

**Output:**

```
rfmt 0.3.0
Rust extension: 0.3.0
```

**Implementation:** [lib/rfmt/cli.rb109-113](https://github.com/fs0414/rfmt/blob/90c575e6/lib/rfmt/cli.rb#L109-L113)

**Sources:** [lib/rfmt/cli.rb109-113](https://github.com/fs0414/rfmt/blob/90c575e6/lib/rfmt/cli.rb#L109-L113) [docs/user\_guide.md219-223](https://github.com/fs0414/rfmt/blob/90c575e6/docs/user_guide.md#L219-L223)

---

### config

Displays the current configuration in JSON format, including discovered settings and defaults.

**Syntax:**

**Output:**

**Implementation:** [lib/rfmt/cli.rb115-120](https://github.com/fs0414/rfmt/blob/90c575e6/lib/rfmt/cli.rb#L115-L120)

**Sources:** [lib/rfmt/cli.rb115-120](https://github.com/fs0414/rfmt/blob/90c575e6/lib/rfmt/cli.rb#L115-L120)

---

### init

Creates a `.rfmt.yml` configuration file with default settings.

**Syntax:**

**Options:**

| Option | Type | Default | Description |
| --- | --- | --- | --- |
| `--force` | boolean | `false` | Overwrite existing configuration |
| `--path` | string | `.rfmt.yml` | Configuration file path |

**Examples:**

**Generated Configuration:**

**Implementation:** [lib/rfmt/cli.rb125-139](https://github.com/fs0414/rfmt/blob/90c575e6/lib/rfmt/cli.rb#L125-L139)

**Sources:** [lib/rfmt/cli.rb125-139](https://github.com/fs0414/rfmt/blob/90c575e6/lib/rfmt/cli.rb#L125-L139) [README.md113-153](https://github.com/fs0414/rfmt/blob/90c575e6/README.md#L113-L153)

---

### cache

Manages the formatting cache. The cache system stores file hashes to skip formatting unchanged files, significantly improving performance on large projects.

**Subcommands:**

#### cache clear

Removes all cache data.

**Syntax:**

**Example:**

**Implementation:** [lib/rfmt/cli.rb15-22](https://github.com/fs0414/rfmt/blob/90c575e6/lib/rfmt/cli.rb#L15-L22)

#### cache stats

Displays cache statistics including directory location, file count, and total size.

**Syntax:**

**Output:**

```
Cache directory: /Users/username/.cache/rfmt
Total files in cache: 142
Cache size: 45.32 KB
```

**Implementation:** [lib/rfmt/cli.rb24-33](https://github.com/fs0414/rfmt/blob/90c575e6/lib/rfmt/cli.rb#L24-L33)

#### cache prune

Removes cache entries for files that no longer exist.

**Syntax:**

**Output:**

```
Pruned 12 stale cache entries
```

**Implementation:** [lib/rfmt/cli.rb35-42](https://github.com/fs0414/rfmt/blob/90c575e6/lib/rfmt/cli.rb#L35-L42)

**Sources:** [lib/rfmt/cli.rb14-43](https://github.com/fs0414/rfmt/blob/90c575e6/lib/rfmt/cli.rb#L14-L43)

---

## Global Options

These options are available for all commands:

| Option | Alias | Type | Description |
| --- | --- | --- | --- |
| `--config` |  | string | Path to custom configuration file |
| `--verbose` | `-v` | boolean | Enable verbose output and debug logging |

**Examples:**

**Debug Logging:**

The `--verbose` flag sets the `RFMT_DEBUG` environment variable before loading the library [lib/rfmt/cli.rb6](https://github.com/fs0414/rfmt/blob/90c575e6/lib/rfmt/cli.rb#L6-L6) This enables detailed logging including:

* Configuration file discovery
* File processing details
* Cache operations
* Internal Rust extension operations

Alternatively, set environment variables directly:

**Implementation:** [lib/rfmt/cli.rb47-48](https://github.com/fs0414/rfmt/blob/90c575e6/lib/rfmt/cli.rb#L47-L48)

**Sources:** [lib/rfmt/cli.rb47-48](https://github.com/fs0414/rfmt/blob/90c575e6/lib/rfmt/cli.rb#L47-L48) [lib/rfmt/cli.rb6](https://github.com/fs0414/rfmt/blob/90c575e6/lib/rfmt/cli.rb#L6-L6) [docs/user\_guide.md177-183](https://github.com/fs0414/rfmt/blob/90c575e6/docs/user_guide.md#L177-L183)

---

## Exit Codes

The CLI returns specific exit codes to indicate success or failure:

| Code | Meaning | Use Case |
| --- | --- | --- |
| `0` | Success | All files formatted or already formatted |
| `1` | Error occurred | Parse errors, I/O errors, or other failures |
| `2` | Files need formatting | Used with `--check` flag in CI/CD |

**Exit Code Logic:**

**Implementation:**

**CI/CD Usage:**

**Sources:** [lib/rfmt/cli.rb256](https://github.com/fs0414/rfmt/blob/90c575e6/lib/rfmt/cli.rb#L256-L256) [docs/user\_guide.md225-230](https://github.com/fs0414/rfmt/blob/90c575e6/docs/user_guide.md#L225-L230)

---

## Processing Pipeline

**Key Methods:**

* **load\_config** [lib/rfmt/cli.rb143-149](https://github.com/fs0414/rfmt/blob/90c575e6/lib/rfmt/cli.rb#L143-L149): Discovers and loads configuration
* **files\_to\_format** [lib/rfmt/configuration.rb36-44](https://github.com/fs0414/rfmt/blob/90c575e6/lib/rfmt/configuration.rb#L36-L44): Applies include/exclude patterns
* **format\_files\_parallel** [lib/rfmt/cli.rb157-168](https://github.com/fs0414/rfmt/blob/90c575e6/lib/rfmt/cli.rb#L157-L168): Uses `Parallel.map` with `in_processes`
* **format\_single\_file** [lib/rfmt/cli.rb170-191](https://github.com/fs0414/rfmt/blob/90c575e6/lib/rfmt/cli.rb#L170-L191): Core formatting logic with error handling
* **handle\_results** [lib/rfmt/cli.rb193-257](https://github.com/fs0414/rfmt/blob/90c575e6/lib/rfmt/cli.rb#L193-L257): Processes outcomes and updates cache
* **show\_diff** [lib/rfmt/cli.rb259-282](https://github.com/fs0414/rfmt/blob/90c575e6/lib/rfmt/cli.rb#L259-L282): Displays changes using Diffy gem

**Sources:** [lib/rfmt/cli.rb143-308](https://github.com/fs0414/rfmt/blob/90c575e6/lib/rfmt/cli.rb#L143-L308) [lib/rfmt/configuration.rb36-44](https://github.com/fs0414/rfmt/blob/90c575e6/lib/rfmt/configuration.rb#L36-L44)

---

## Parallel Processing

By default, `rfmt` processes multiple files in parallel to maximize performance [lib/rfmt/cli.rb96-100](https://github.com/fs0414/rfmt/blob/90c575e6/lib/rfmt/cli.rb#L96-L100) The parallelism is controlled by:

**Process Count:**

* Default: CPU core count (`Parallel.processor_count`)
* Override: `--jobs N` option
* Disable: `--no-parallel` flag

**Implementation Details:**

**Trade-offs:**

| Factor | Sequential | Parallel |
| --- | --- | --- |
| Speed | Slower on multiple files | Faster (near-linear scaling) |
| Memory | Lower | Higher (multiple processes) |
| Output order | Predictable | Non-deterministic |
| Use case | Single file or debugging | Multiple files in production |

**Sources:** [lib/rfmt/cli.rb96-100](https://github.com/fs0414/rfmt/blob/90c575e6/lib/rfmt/cli.rb#L96-L100) [lib/rfmt/cli.rb157-168](https://github.com/fs0414/rfmt/blob/90c575e6/lib/rfmt/cli.rb#L157-L168)

---

## Cache System Integration

The CLI integrates with `Rfmt::Cache` to skip formatting of unchanged files:

**Cache Workflow:**

1. **Initialize:** Create `Cache` instance with optional custom directory [lib/rfmt/cli.rb71-74](https://github.com/fs0414/rfmt/blob/90c575e6/lib/rfmt/cli.rb#L71-L74)
2. **Filter:** Call `needs_formatting?` for each file to check cache [lib/rfmt/cli.rb79](https://github.com/fs0414/rfmt/blob/90c575e6/lib/rfmt/cli.rb#L79-L79)
3. **Update:** Mark files as formatted after successful write [lib/rfmt/cli.rb220](https://github.com/fs0414/rfmt/blob/90c575e6/lib/rfmt/cli.rb#L220-L220)
4. **Persist:** Save cache to disk after processing all files [lib/rfmt/cli.rb234](https://github.com/fs0414/rfmt/blob/90c575e6/lib/rfmt/cli.rb#L234-L234)

**Cache Skip Reporting:**

**Cache Options:**

For cache internals, see [Caching System](https://deepwiki.com/fs0414/rfmt/4.5-caching-system.html).

**Sources:** [lib/rfmt/cli.rb71-87](https://github.com/fs0414/rfmt/blob/90c575e6/lib/rfmt/cli.rb#L71-L87) [lib/rfmt/cli.rb220](https://github.com/fs0414/rfmt/blob/90c575e6/lib/rfmt/cli.rb#L220-L220) [lib/rfmt/cli.rb234](https://github.com/fs0414/rfmt/blob/90c575e6/lib/rfmt/cli.rb#L234-L234)

---

## Diff Output Modes

The `--diff` option supports three formats via the `--diff-format` option:

### Unified Diff (default)

Standard unified diff with context lines:

**Output:**

### Color Diff

Line-by-line colored diff:

### Side-by-Side

Shows original and formatted side-by-side (falls back to unified with more context):

**Implementation:** [lib/rfmt/cli.rb259-282](https://github.com/fs0414/rfmt/blob/90c575e6/lib/rfmt/cli.rb#L259-L282) using the Diffy gem [lib/rfmt/cli.rb260](https://github.com/fs0414/rfmt/blob/90c575e6/lib/rfmt/cli.rb#L260-L260)

**Sources:** [lib/rfmt/cli.rb259-306](https://github.com/fs0414/rfmt/blob/90c575e6/lib/rfmt/cli.rb#L259-L306)

---

## Common Workflows

### Local Development

Format files before committing:

### CI/CD Integration

Check formatting in continuous integration:

**Exit code behavior:**

* `0`: All files formatted → CI passes
* `2`: Files need formatting → CI fails
* `1`: Error occurred → CI fails

### Pre-commit Hook

Using Lefthook (recommended approach used in rfmt development):

### Large Project Optimization

For projects with thousands of files:

**Sources:** [README.md304-344](https://github.com/fs0414/rfmt/blob/90c575e6/README.md#L304-L344) [docs/user\_guide.md496-521](https://github.com/fs0414/rfmt/blob/90c575e6/docs/user_guide.md#L496-L521)

---

## Error Handling

The CLI provides detailed error reporting with contextual information:

### Error Display Format

**Example Output:**

```
Error in lib/user.rb: Parse error at line 5, column 10
Expected closing 'end' for class definition
✗ Failed: 1 error(s) occurred
```

### Summary Messages

The CLI always displays a summary after processing [lib/rfmt/cli.rb237-254](https://github.com/fs0414/rfmt/blob/90c575e6/lib/rfmt/cli.rb#L237-L254):

**Success:**

```
✓ Success! Formatted 5 file(s)
```

**No changes:**

```
✓ Success! All 142 files are already formatted
```

**Check mode failure:**

```
✗ Check failed: 3 file(s) need formatting
```

**Errors:**

```
✗ Failed: 2 error(s) occurred
```

**Sources:** [lib/rfmt/cli.rb193-257](https://github.com/fs0414/rfmt/blob/90c575e6/lib/rfmt/cli.rb#L193-L257)

---

## Performance Characteristics

Based on benchmarks in [README.md49-75](https://github.com/fs0414/rfmt/blob/90c575e6/README.md#L49-L75):

| Project Size | Files | rfmt Time | Performance Notes |
| --- | --- | --- | --- |
| Single file | 1 | ~191ms | Includes startup overhead |
| Small directory | 14 | ~176ms | Parallel processing benefit |
| Full project | 111 | ~172ms | Constant time with caching |

**Key optimizations:**

1. **Constant execution time:** Cache skips unchanged files
2. **Parallel processing:** Near-linear scaling with CPU cores
3. **Low overhead:** Rust core minimizes per-file cost

**Sources:** [README.md49-75](https://github.com/fs0414/rfmt/blob/90c575e6/README.md#L49-L75)

Dismiss

Refresh this wiki

Enter email to refresh

### On this page

* [CLI Usage](https://deepwiki.com/fs0414/rfmt/3.1-cli-usage.html#cli-usage)
* [Overview](https://deepwiki.com/fs0414/rfmt/3.1-cli-usage.html#overview)
* [Command Architecture](https://deepwiki.com/fs0414/rfmt/3.1-cli-usage.html#command-architecture)
* [Commands](https://deepwiki.com/fs0414/rfmt/3.1-cli-usage.html#commands)
* [format [FILES...]](3.1-cli-usage.html#format-files)
* [check [FILES...]](3.1-cli-usage.html#check-files)
* [version](https://deepwiki.com/fs0414/rfmt/3.1-cli-usage.html#version)
* [config](https://deepwiki.com/fs0414/rfmt/3.1-cli-usage.html#config)
* [init](https://deepwiki.com/fs0414/rfmt/3.1-cli-usage.html#init)
* [cache](https://deepwiki.com/fs0414/rfmt/3.1-cli-usage.html#cache)
* [cache clear](https://deepwiki.com/fs0414/rfmt/3.1-cli-usage.html#cache-clear)
* [cache stats](https://deepwiki.com/fs0414/rfmt/3.1-cli-usage.html#cache-stats)
* [cache prune](https://deepwiki.com/fs0414/rfmt/3.1-cli-usage.html#cache-prune)
* [Global Options](https://deepwiki.com/fs0414/rfmt/3.1-cli-usage.html#global-options)
* [Exit Codes](https://deepwiki.com/fs0414/rfmt/3.1-cli-usage.html#exit-codes)
* [Processing Pipeline](https://deepwiki.com/fs0414/rfmt/3.1-cli-usage.html#processing-pipeline)
* [Parallel Processing](https://deepwiki.com/fs0414/rfmt/3.1-cli-usage.html#parallel-processing)
* [Cache System Integration](https://deepwiki.com/fs0414/rfmt/3.1-cli-usage.html#cache-system-integration)
* [Diff Output Modes](https://deepwiki.com/fs0414/rfmt/3.1-cli-usage.html#diff-output-modes)
* [Unified Diff (default)](https://deepwiki.com/fs0414/rfmt/3.1-cli-usage.html#unified-diff-default)
* [Color Diff](https://deepwiki.com/fs0414/rfmt/3.1-cli-usage.html#color-diff)
* [Side-by-Side](https://deepwiki.com/fs0414/rfmt/3.1-cli-usage.html#side-by-side)
* [Common Workflows](https://deepwiki.com/fs0414/rfmt/3.1-cli-usage.html#common-workflows)
* [Local Development](https://deepwiki.com/fs0414/rfmt/3.1-cli-usage.html#local-development)
* [CI/CD Integration](https://deepwiki.com/fs0414/rfmt/3.1-cli-usage.html#cicd-integration)
* [Pre-commit Hook](https://deepwiki.com/fs0414/rfmt/3.1-cli-usage.html#pre-commit-hook)
* [Large Project Optimization](https://deepwiki.com/fs0414/rfmt/3.1-cli-usage.html#large-project-optimization)
* [Error Handling](https://deepwiki.com/fs0414/rfmt/3.1-cli-usage.html#error-handling)
* [Error Display Format](https://deepwiki.com/fs0414/rfmt/3.1-cli-usage.html#error-display-format)
* [Summary Messages](https://deepwiki.com/fs0414/rfmt/3.1-cli-usage.html#summary-messages)
* [Performance Characteristics](https://deepwiki.com/fs0414/rfmt/3.1-cli-usage.html#performance-characteristics)
