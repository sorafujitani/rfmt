---
title: "Formatting Engine (Emitter) | fs0414/rfmt | DeepWiki"
source_url: "https://deepwiki.com/fs0414/rfmt/4.2-formatting-engine-(emitter)"
fetched_at: "2026-01-13T10:53:43.101777+00:00"
---



Loading...

Index your code with Devin

[DeepWiki](https://deepwiki.com/)

[DeepWiki](https://deepwiki.com/)

[fs0414/rfmt](https://github.com/fs0414/rfmt "Open repository")

Index your code with

Devin

Edit WikiShare

Loading...

Last indexed: 3 January 2026 ([90c575](https://github.com/fs0414/rfmt/commits/90c575e6))

* [Overview](https://deepwiki.com/fs0414/rfmt/1-overview.html)
* [Architecture Overview](https://deepwiki.com/fs0414/rfmt/1.1-architecture-overview.html)
* [Key Concepts](https://deepwiki.com/fs0414/rfmt/1.2-key-concepts.html)
* [Getting Started](https://deepwiki.com/fs0414/rfmt/2-getting-started.html)
* [Installation](https://deepwiki.com/fs0414/rfmt/2.1-installation.html)
* [Configuration](https://deepwiki.com/fs0414/rfmt/2.2-configuration.html)
* [User Guides](https://deepwiki.com/fs0414/rfmt/3-user-guides.html)
* [CLI Usage](https://deepwiki.com/fs0414/rfmt/3.1-cli-usage.html)
* [Ruby API](https://deepwiki.com/fs0414/rfmt/3.2-ruby-api.html)
* [Editor Integration](https://deepwiki.com/fs0414/rfmt/3.3-editor-integration.html)
* [Core Systems](https://deepwiki.com/fs0414/rfmt/4-core-systems.html)
* [AST Representation](https://deepwiki.com/fs0414/rfmt/4.1-ast-representation.html)
* [Formatting Engine (Emitter)](https://deepwiki.com/fs0414/rfmt/4.2-formatting-engine-(emitter).html)
* [Parser Integration (PrismBridge)](https://deepwiki.com/fs0414/rfmt/4.3-parser-integration-(prismbridge).html)
* [Configuration System](https://deepwiki.com/fs0414/rfmt/4.4-configuration-system.html)
* [Caching System](https://deepwiki.com/fs0414/rfmt/4.5-caching-system.html)
* [Logging System](https://deepwiki.com/fs0414/rfmt/4.6-logging-system.html)
* [Formatting Behavior](https://deepwiki.com/fs0414/rfmt/5-formatting-behavior.html)
* [Control Flow Formatting](https://deepwiki.com/fs0414/rfmt/5.1-control-flow-formatting.html)
* [Exception Handling Formatting](https://deepwiki.com/fs0414/rfmt/5.2-exception-handling-formatting.html)
* [Lambda and Block Formatting](https://deepwiki.com/fs0414/rfmt/5.3-lambda-and-block-formatting.html)
* [Development](https://deepwiki.com/fs0414/rfmt/6-development.html)
* [Building from Source](https://deepwiki.com/fs0414/rfmt/6.1-building-from-source.html)
* [Testing](https://deepwiki.com/fs0414/rfmt/6.2-testing.html)
* [Release Process](https://deepwiki.com/fs0414/rfmt/6.3-release-process.html)
* [Reference](https://deepwiki.com/fs0414/rfmt/7-reference.html)
* [Node Types Reference](https://deepwiki.com/fs0414/rfmt/7.1-node-types-reference.html)
* [Configuration Options Reference](https://deepwiki.com/fs0414/rfmt/7.2-configuration-options-reference.html)
* [Error Codes Reference](https://deepwiki.com/fs0414/rfmt/7.3-error-codes-reference.html)
* [Performance and Benchmarks](https://deepwiki.com/fs0414/rfmt/7.4-performance-and-benchmarks.html)

Menu

# Formatting Engine (Emitter)

Relevant source files

* [ext/rfmt/src/ast/mod.rs](https://github.com/fs0414/rfmt/blob/90c575e6/ext/rfmt/src/ast/mod.rs)
* [ext/rfmt/src/emitter/mod.rs](https://github.com/fs0414/rfmt/blob/90c575e6/ext/rfmt/src/emitter/mod.rs)
* [lib/rfmt/prism\_bridge.rb](https://github.com/fs0414/rfmt/blob/90c575e6/lib/rfmt/prism_bridge.rb)
* [lib/rfmt/prism\_node\_extractor.rb](https://github.com/fs0414/rfmt/blob/90c575e6/lib/rfmt/prism_node_extractor.rb)
* [spec/ensure\_formatting\_spec.rb](https://github.com/fs0414/rfmt/blob/90c575e6/spec/ensure_formatting_spec.rb)
* [spec/lambda\_formatting\_spec.rb](https://github.com/fs0414/rfmt/blob/90c575e6/spec/lambda_formatting_spec.rb)

The Emitter is the core formatting engine that transforms the parsed AST back into formatted Ruby source code. It implements a visitor pattern to traverse the AST, applies formatting rules, preserves comments in their correct positions, and extracts original source text when reconstruction is too complex. This component runs entirely in Rust for performance and is responsible for the actual code generation.

For information about the AST structure that the Emitter operates on, see [AST Representation](https://deepwiki.com/fs0414/rfmt/4.1-ast-representation.html). For how the AST is created from Ruby source, see [Parser Integration (PrismBridge)](https://deepwiki.com/fs0414/rfmt/4.3-parser-integration-(prismbridge).html). For configuration options that control formatting behavior, see [Configuration System](https://deepwiki.com/fs0414/rfmt/4.4-configuration-system.html).

## Emitter Architecture

The `Emitter` struct maintains formatting state and orchestrates the emission process. It operates on the deserialized AST, collecting and positioning comments, dispatching to specialized emission methods, and building the formatted output incrementally.

**Sources:** [ext/rfmt/src/emitter/mod.rs14-62](https://github.com/fs0414/rfmt/blob/90c575e6/ext/rfmt/src/emitter/mod.rs#L14-L62)

### Emitter Lifecycle

The emission process follows a well-defined lifecycle:

| Phase | Method | Purpose | Output |
| --- | --- | --- | --- |
| 1. Initialization | `new()` or `with_source()` | Create emitter with configuration and optional source | `Emitter` instance |
| 2. Comment Collection | `collect_comments()` | Recursively traverse AST to gather all comments | Populates `all_comments` |
| 3. Node Emission | `emit_node()` | Dispatch to specialized methods, emit formatted code | Builds `buffer` |
| 4. Remaining Comments | `emit_remaining_comments()` | Emit comments not attached to any node | Appends to `buffer` |
| 5. Finalization | Newline check | Ensure file ends with newline | Final formatted output |

**Sources:** [ext/rfmt/src/emitter/mod.rs45-62](https://github.com/fs0414/rfmt/blob/90c575e6/ext/rfmt/src/emitter/mod.rs#L45-L62)

## Comment System

Comments are preserved throughout formatting by collecting them upfront, tracking which have been emitted, and strategically inserting them at appropriate positions. The system distinguishes between leading comments (before a node), trailing comments (on the same line), and orphaned comments (not associated with any node).

### Comment Emission Strategies

The emitter uses three distinct strategies for emitting comments:

**1. Leading Comments** (`emit_comments_before`)

Emits comments that appear before a given line number, typically at the start of a node definition (class, method, etc.). Preserves blank lines between consecutive comments.

```
# This is a leading comment
# It appears before the class
class Example
end
```

**Sources:** [ext/rfmt/src/emitter/mod.rs94-123](https://github.com/fs0414/rfmt/blob/90c575e6/ext/rfmt/src/emitter/mod.rs#L94-L123)

**2. Trailing Comments** (`emit_trailing_comments`)

Emits comments on the same line as code, such as inline annotations or directives.

```
class Example # rubocop:disable Style/Documentation
end
```

**Sources:** [ext/rfmt/src/emitter/mod.rs126-146](https://github.com/fs0414/rfmt/blob/90c575e6/ext/rfmt/src/emitter/mod.rs#L126-L146)

**3. Remaining Comments** (`emit_remaining_comments`)

Emits orphaned comments at the end of the file that weren't associated with any particular node. Preserves gap spacing between comments.

**Sources:** [ext/rfmt/src/emitter/mod.rs65-83](https://github.com/fs0414/rfmt/blob/90c575e6/ext/rfmt/src/emitter/mod.rs#L65-L83)

## Node Dispatch Pattern

The emitter uses a centralized dispatch mechanism that routes each AST node to its specialized emission handler based on the `NodeType`. This pattern enables clean separation of formatting logic for different Ruby constructs.

**Sources:** [ext/rfmt/src/emitter/mod.rs149-171](https://github.com/fs0414/rfmt/blob/90c575e6/ext/rfmt/src/emitter/mod.rs#L149-L171) [ext/rfmt/src/ast/mod.rs28-184](https://github.com/fs0414/rfmt/blob/90c575e6/ext/rfmt/src/ast/mod.rs#L28-L184)

## Specialized Emission Methods

Each node type has a dedicated emission method that understands its specific structure and formatting requirements. These methods handle indentation, keyword placement, child node emission, and structural details.

### Definition Emission

**Class Definition** (`emit_class`)

Emits class definitions with proper handling of superclasses (including complex ones like `ActiveRecord::Migration[8.0]`), comments, and body content. Skips structural nodes (name, superclass) when emitting body.

| Step | Code Location | Description |
| --- | --- | --- |
| 1. Leading comments | [ext/rfmt/src/emitter/mod.rs232](https://github.com/fs0414/rfmt/blob/90c575e6/ext/rfmt/src/emitter/mod.rs#L232-L232) | `emit_comments_before()` |
| 2. Class keyword | [ext/rfmt/src/emitter/mod.rs234-235](https://github.com/fs0414/rfmt/blob/90c575e6/ext/rfmt/src/emitter/mod.rs#L234-L235) | `write!(buffer, "class ")` |
| 3. Class name | [ext/rfmt/src/emitter/mod.rs237-239](https://github.com/fs0414/rfmt/blob/90c575e6/ext/rfmt/src/emitter/mod.rs#L237-L239) | From `metadata["name"]` |
| 4. Superclass | [ext/rfmt/src/emitter/mod.rs241-243](https://github.com/fs0414/rfmt/blob/90c575e6/ext/rfmt/src/emitter/mod.rs#L241-L243) | From `metadata["superclass"]` |
| 5. Trailing comments | [ext/rfmt/src/emitter/mod.rs246](https://github.com/fs0414/rfmt/blob/90c575e6/ext/rfmt/src/emitter/mod.rs#L246-L246) | `emit_trailing_comments()` |
| 6. Body | [ext/rfmt/src/emitter/mod.rs249-261](https://github.com/fs0414/rfmt/blob/90c575e6/ext/rfmt/src/emitter/mod.rs#L249-L261) | Emit non-structural children |
| 7. End keyword | [ext/rfmt/src/emitter/mod.rs270-271](https://github.com/fs0414/rfmt/blob/90c575e6/ext/rfmt/src/emitter/mod.rs#L270-L271) | `write!(buffer, "end")` |

**Sources:** [ext/rfmt/src/emitter/mod.rs230-274](https://github.com/fs0414/rfmt/blob/90c575e6/ext/rfmt/src/emitter/mod.rs#L230-L274)

**Module Definition** (`emit_module`)

Similar to class emission but without superclass handling. Emits module keyword, name, body, and end.

**Sources:** [ext/rfmt/src/emitter/mod.rs277-313](https://github.com/fs0414/rfmt/blob/90c575e6/ext/rfmt/src/emitter/mod.rs#L277-L313)

**Method Definition** (`emit_method`)

Emits method definitions including class methods (`def self.method_name`). Uses source extraction for complex parameter lists since reconstructing parameters with defaults from AST is complex.

**Sources:** [ext/rfmt/src/emitter/mod.rs316-385](https://github.com/fs0414/rfmt/blob/90c575e6/ext/rfmt/src/emitter/mod.rs#L316-L385)

### Control Flow Emission

**If/Unless/Elsif** (`emit_if_unless`)

Handles multiple forms of conditional statements:

* Standard if/unless blocks
* Postfix modifiers (`statement if condition`)
* Ternary operators (`condition ? true_expr : false_expr`)
* Elsif chains

The method detects the form by examining node locations and metadata.

**Sources:** [ext/rfmt/src/emitter/mod.rs650-823](https://github.com/fs0414/rfmt/blob/90c575e6/ext/rfmt/src/emitter/mod.rs#L650-L823)

**Case/When** (`emit_case` and `emit_when`)

Emits case statements with when clauses and optional else. Extracts the predicate and conditions from source since they can be complex expressions.

**Sources:** [ext/rfmt/src/emitter/mod.rs550-605](https://github.com/fs0414/rfmt/blob/90c575e6/ext/rfmt/src/emitter/mod.rs#L550-L605) [ext/rfmt/src/emitter/mod.rs608-645](https://github.com/fs0414/rfmt/blob/90c575e6/ext/rfmt/src/emitter/mod.rs#L608-L645)

**While/Until Loops** (`emit_while_until`)

Emits loop constructs with the appropriate keyword. Uses source extraction for predicates to preserve exact expressions.

**Sources:** [ext/rfmt/src/emitter/mod.rs165-166](https://github.com/fs0414/rfmt/blob/90c575e6/ext/rfmt/src/emitter/mod.rs#L165-L166)

### Exception Handling Emission

**Begin Block** (`emit_begin`)

Handles both explicit `begin...end` blocks and implicit begin blocks that wrap method bodies with rescue/ensure. Detects the form by checking if source starts with "begin" keyword.

**Sources:** [ext/rfmt/src/emitter/mod.rs387-424](https://github.com/fs0414/rfmt/blob/90c575e6/ext/rfmt/src/emitter/mod.rs#L387-L424) [spec/ensure\_formatting\_spec.rb6-21](https://github.com/fs0414/rfmt/blob/90c575e6/spec/ensure_formatting_spec.rb#L6-L21)

**Rescue Clause** (`emit_rescue`)

Emits rescue clauses with exception classes and variables. Handles multi-line rescue declarations (when exception classes span multiple lines with commas or backslashes). Recursively handles subsequent rescue clauses.

**Sources:** [ext/rfmt/src/emitter/mod.rs427-514](https://github.com/fs0414/rfmt/blob/90c575e6/ext/rfmt/src/emitter/mod.rs#L427-L514)

**Ensure Clause** (`emit_ensure`)

Emits ensure blocks, properly dedenting the `ensure` keyword to align with `begin`/`rescue` or method definition.

**Sources:** [ext/rfmt/src/emitter/mod.rs517-538](https://github.com/fs0414/rfmt/blob/90c575e6/ext/rfmt/src/emitter/mod.rs#L517-L538)

### Expression Emission

**Method Call** (`emit_call`)

The most complex emission method. Handles method calls with blocks, distinguishing between `do...end` and `{ }` block styles, and between single-line and multi-line blocks.

**Sources:** [ext/rfmt/src/emitter/mod.rs826-985](https://github.com/fs0414/rfmt/blob/90c575e6/ext/rfmt/src/emitter/mod.rs#L826-L985)

**Lambda** (`emit_lambda`)

Lambda syntax is complex (stabby lambda `->` vs `lambda`, `{}` vs `do...end`, parameters). Uses source extraction to preserve original style.

**Sources:** [ext/rfmt/src/emitter/mod.rs541-547](https://github.com/fs0414/rfmt/blob/90c575e6/ext/rfmt/src/emitter/mod.rs#L541-L547) [spec/lambda\_formatting\_spec.rb](https://github.com/fs0414/rfmt/blob/90c575e6/spec/lambda_formatting_spec.rb)

## Source Extraction Strategy

For complex syntax that's difficult to reconstruct accurately from the AST, the emitter falls back to extracting the original source text. This hybrid approach balances correctness with implementation complexity.

### When Source Extraction is Used

| Construct | Reason | Method |
| --- | --- | --- |
| Method parameters | Defaults, splats, keyword args | [ext/rfmt/src/emitter/mod.rs333-358](https://github.com/fs0414/rfmt/blob/90c575e6/ext/rfmt/src/emitter/mod.rs#L333-L358) |
| Lambda syntax | Multiple forms (-> vs lambda, styles) | [ext/rfmt/src/emitter/mod.rs541-547](https://github.com/fs0414/rfmt/blob/90c575e6/ext/rfmt/src/emitter/mod.rs#L541-L547) |
| If/Case predicates | Complex expressions | [ext/rfmt/src/emitter/mod.rs771-777](https://github.com/fs0414/rfmt/blob/90c575e6/ext/rfmt/src/emitter/mod.rs#L771-L777) |
| When conditions | Multiple conditions | [ext/rfmt/src/emitter/mod.rs622-631](https://github.com/fs0414/rfmt/blob/90c575e6/ext/rfmt/src/emitter/mod.rs#L622-L631) |
| Block parameters | Optional, defaults, multiple | [ext/rfmt/src/emitter/mod.rs962-985](https://github.com/fs0414/rfmt/blob/90c575e6/ext/rfmt/src/emitter/mod.rs#L962-L985) |
| Rescue declarations | Multiple exception classes | [ext/rfmt/src/emitter/mod.rs438-484](https://github.com/fs0414/rfmt/blob/90c575e6/ext/rfmt/src/emitter/mod.rs#L438-L484) |
| Inline blocks | Preserve exact spacing | [ext/rfmt/src/emitter/mod.rs948-956](https://github.com/fs0414/rfmt/blob/90c575e6/ext/rfmt/src/emitter/mod.rs#L948-L956) |

### Source Extraction Implementation

The emitter stores the original source string and uses `Location` offsets to extract spans:

The generic emission methods handle nodes without specialized emitters:

**`emit_generic_without_comments`** - Extracts source for a node, emitting indentation and trailing comments.

**`emit_generic`** - Like above but also emits leading comments.

**Sources:** [ext/rfmt/src/emitter/mod.rs988-1001](https://github.com/fs0414/rfmt/blob/90c575e6/ext/rfmt/src/emitter/mod.rs#L988-L1001) [ext/rfmt/src/ast/mod.rs16-25](https://github.com/fs0414/rfmt/blob/90c575e6/ext/rfmt/src/ast/mod.rs#L16-L25)

## Indentation Management

Indentation is managed by passing an `indent_level` parameter through the emission recursion and incrementing it when emitting nested structures. The actual indentation string is determined by configuration.

### Indentation Application

### Indentation Rules by Construct

| Construct | Indentation | Example |
| --- | --- | --- |
| Class/Module body | `indent_level + 1` | Class members indented |
| Method body | `indent_level + 1` | Method content indented |
| If/Unless then/else | `indent_level + 1` | Conditional branches indented |
| Case when clauses | `indent_level + 1` | When bodies indented |
| Block body | `indent_level + 1` | Block content indented |
| Rescue clause | `indent_level - 1` | Rescue at method/begin level |
| Ensure clause | `indent_level - 1` | Ensure at method/begin level |

**Sources:** [ext/rfmt/src/emitter/mod.rs95-98](https://github.com/fs0414/rfmt/blob/90c575e6/ext/rfmt/src/emitter/mod.rs#L95-L98) [ext/rfmt/src/emitter/mod.rs434](https://github.com/fs0414/rfmt/blob/90c575e6/ext/rfmt/src/emitter/mod.rs#L434-L434) [ext/rfmt/src/emitter/mod.rs519](https://github.com/fs0414/rfmt/blob/90c575e6/ext/rfmt/src/emitter/mod.rs#L519-L519) [ext/rfmt/src/config1-50](https://github.com/fs0414/rfmt/blob/90c575e6/ext/rfmt/src/config#L1-L50) (referenced in imports)

## Block Style Preservation

Ruby blocks can use two styles: `do...end` and `{ }`. The emitter preserves the original style by detecting it from the source and emitting accordingly.

### Block Style Detection

The detection is simple: check the first character of the block in the source. If it's `{`, use brace style; otherwise, use do-end style.

```
# do...end style
items.each do |item|
  process(item)
end

# Brace style (multiline)
items.map {|x|
  x * 2
}

# Brace style (inline)
items.map { |x| x * 2 }
```

### Block Parameter Extraction

Block parameters (`|x, y|`) are extracted from the source by finding the pipe characters in the first line of the block. This preserves parameter names and defaults.

**Sources:** [ext/rfmt/src/emitter/mod.rs860-873](https://github.com/fs0414/rfmt/blob/90c575e6/ext/rfmt/src/emitter/mod.rs#L860-L873) [ext/rfmt/src/emitter/mod.rs962-985](https://github.com/fs0414/rfmt/blob/90c575e6/ext/rfmt/src/emitter/mod.rs#L962-L985)

## Statement Spacing

The emitter preserves meaningful blank lines between statements while normalizing excessive spacing. This is done by examining line gaps in the original source.

### Program-Level Statements

Between top-level statements, the emitter adds:

* 1 newline if statements were consecutive (no gap)
* 2 newlines (1 blank line) if there was a gap

**Sources:** [ext/rfmt/src/emitter/mod.rs174-192](https://github.com/fs0414/rfmt/blob/90c575e6/ext/rfmt/src/emitter/mod.rs#L174-L192)

### Body-Level Statements

Within class/module/method bodies, similar logic applies but also considers comments between statements when calculating gaps.

**Sources:** [ext/rfmt/src/emitter/mod.rs195-227](https://github.com/fs0414/rfmt/blob/90c575e6/ext/rfmt/src/emitter/mod.rs#L195-L227)

## Structural Node Filtering

Some AST nodes are "structural" - they represent components of definitions rather than executable statements (e.g., parameter nodes, constant names). These are skipped when emitting body content since they're already represented in the definition syntax.

The `is_structural_node()` helper identifies these nodes by type:

* Constant nodes (`ConstantReadNode`, `ConstantWriteNode`, `ConstantPathNode`)
* Parameter nodes (all parameter types)

This prevents duplicate emission of components that are part of the parent node's syntax.

**Sources:** [ext/rfmt/src/emitter/mod.rs257-259](https://github.com/fs0414/rfmt/blob/90c575e6/ext/rfmt/src/emitter/mod.rs#L257-L259) [ext/rfmt/src/emitter/mod.rs294-297](https://github.com/fs0414/rfmt/blob/90c575e6/ext/rfmt/src/emitter/mod.rs#L294-L297) [ext/rfmt/src/emitter/mod.rs366-368](https://github.com/fs0414/rfmt/blob/90c575e6/ext/rfmt/src/emitter/mod.rs#L366-L368)

Dismiss

Refresh this wiki

Enter email to refresh

### On this page

* [Formatting Engine (Emitter)](https://deepwiki.com/fs0414/rfmt/4.2-formatting-engine-(emitter).html#formatting-engine-emitter)
* [Emitter Architecture](https://deepwiki.com/fs0414/rfmt/4.2-formatting-engine-(emitter).html#emitter-architecture)
* [Emitter Lifecycle](https://deepwiki.com/fs0414/rfmt/4.2-formatting-engine-(emitter).html#emitter-lifecycle)
* [Comment System](https://deepwiki.com/fs0414/rfmt/4.2-formatting-engine-(emitter).html#comment-system)
* [Comment Emission Strategies](https://deepwiki.com/fs0414/rfmt/4.2-formatting-engine-(emitter).html#comment-emission-strategies)
* [Node Dispatch Pattern](https://deepwiki.com/fs0414/rfmt/4.2-formatting-engine-(emitter).html#node-dispatch-pattern)
* [Specialized Emission Methods](https://deepwiki.com/fs0414/rfmt/4.2-formatting-engine-(emitter).html#specialized-emission-methods)
* [Definition Emission](https://deepwiki.com/fs0414/rfmt/4.2-formatting-engine-(emitter).html#definition-emission)
* [Control Flow Emission](https://deepwiki.com/fs0414/rfmt/4.2-formatting-engine-(emitter).html#control-flow-emission)
* [Exception Handling Emission](https://deepwiki.com/fs0414/rfmt/4.2-formatting-engine-(emitter).html#exception-handling-emission)
* [Expression Emission](https://deepwiki.com/fs0414/rfmt/4.2-formatting-engine-(emitter).html#expression-emission)
* [Source Extraction Strategy](https://deepwiki.com/fs0414/rfmt/4.2-formatting-engine-(emitter).html#source-extraction-strategy)
* [When Source Extraction is Used](https://deepwiki.com/fs0414/rfmt/4.2-formatting-engine-(emitter).html#when-source-extraction-is-used)
* [Source Extraction Implementation](https://deepwiki.com/fs0414/rfmt/4.2-formatting-engine-(emitter).html#source-extraction-implementation)
* [Indentation Management](https://deepwiki.com/fs0414/rfmt/4.2-formatting-engine-(emitter).html#indentation-management)
* [Indentation Application](https://deepwiki.com/fs0414/rfmt/4.2-formatting-engine-(emitter).html#indentation-application)
* [Indentation Rules by Construct](https://deepwiki.com/fs0414/rfmt/4.2-formatting-engine-(emitter).html#indentation-rules-by-construct)
* [Block Style Preservation](https://deepwiki.com/fs0414/rfmt/4.2-formatting-engine-(emitter).html#block-style-preservation)
* [Block Style Detection](https://deepwiki.com/fs0414/rfmt/4.2-formatting-engine-(emitter).html#block-style-detection)
* [Block Parameter Extraction](https://deepwiki.com/fs0414/rfmt/4.2-formatting-engine-(emitter).html#block-parameter-extraction)
* [Statement Spacing](https://deepwiki.com/fs0414/rfmt/4.2-formatting-engine-(emitter).html#statement-spacing)
* [Program-Level Statements](https://deepwiki.com/fs0414/rfmt/4.2-formatting-engine-(emitter).html#program-level-statements)
* [Body-Level Statements](https://deepwiki.com/fs0414/rfmt/4.2-formatting-engine-(emitter).html#body-level-statements)
* [Structural Node Filtering](https://deepwiki.com/fs0414/rfmt/4.2-formatting-engine-(emitter).html#structural-node-filtering)
