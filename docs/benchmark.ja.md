# パフォーマンスベンチマーク

## テスト環境

### システム
- CPU: arm64 (Apple Silicon)
- Ruby: 3.4.5 (arm64-darwin20)

### ツール
- rfmt: 0.2.4
- RuboCop: 1.81.7

### テストプロジェクト
- 総ファイル数: 111 Rubyファイル
- 総行数: 3,241行
- 種類: Railsアプリケーション

### 測定方法
- 測定回数: 各テスト10回
- 測定指標: 平均値、中央値、標準偏差
- 測定日: 2025-11-25

## 測定結果

### 1. 単一ファイルのパフォーマンス

テストファイル: `20250202060108_articles.rb` (234バイト、11行)

| ツール | 平均 | 中央値 | 標準偏差 | 最小 | 最大 |
|------|---------|--------|---------|-----|-----|
| rfmt | 191.2ms | 189.0ms | 22.7ms | 162.5ms | 243.7ms |
| RuboCop | 1.38s | 1.25s | 418.6ms | 1.19s | 2.56s |

**比率**: 7.21倍

### 2. ディレクトリのパフォーマンス

テストディレクトリ: `app/models` (14ファイル)

| ツール | 平均 | 中央値 | 標準偏差 | 最小 | 最大 |
|------|---------|--------|---------|-----|-----|
| rfmt | 175.8ms | 172.9ms | 8.2ms | 167.7ms | 192.1ms |
| RuboCop | 1.682s | 1.656s | 162.6ms | 1.54s | 2.10s |

**比率**: 9.57倍

### 3. フルプロジェクト (チェックモード)

全111ファイルをチェックモードで実行（ファイル変更なし）

| ツール | 平均 | 中央値 | 標準偏差 | 最小 | 最大 |
|------|---------|--------|---------|-----|-----|
| rfmt | 171.9ms | 174.5ms | 9.3ms | 150.1ms | 184.9ms |
| RuboCop | 4.357s | 3.33s | 3.134s | 3.01s | 13.23s |

**比率**: 25.35倍

## 観察事項

### 実行時間の一貫性

rfmtは全テストで一貫した実行時間を示す:
- 標準偏差: 8-23ms
- 実行間の変動が小さい

RuboCopは変動が大きい:
- 標準偏差: 163-3,134ms
- フルプロジェクトテストで外れ値が顕著（最大13.23s vs 中央値3.33s）

### スケーラビリティ

| テスト種別 | ファイル数 | rfmt | RuboCop | 比率 |
|-----------|-------|------|---------|-------|
| 単一ファイル | 1 | 191ms | 1.38s | 7.21倍 |
| ディレクトリ | 14 | 176ms | 1.68s | 9.57倍 |
| フルプロジェクト | 111 | 172ms | 4.36s | 25.35倍 |

rfmtの実行時間はファイル数に関わらずほぼ一定（172-191ms）。

RuboCopの実行時間はファイル数に応じて増加。

## ユースケース

### 単一ファイルフォーマット
- エディタの保存時操作
- 変更ファイルのみのpre-commitフック
- 時間差: 1ファイルあたり約1.2秒

### ディレクトリフォーマット
- モジュールやコンポーネント単位のフォーマット
- コードベースの部分的な更新
- 時間差: 1ディレクトリあたり約1.5秒

### フルプロジェクト検証
- CI/CDパイプライン
- リリース前チェック
- 時間差: 1プロジェクトあたり約4.2秒

## 生データ

完全なベンチマーク結果:
- [`docs/benchmark/results.json`](./benchmark/results.json)

## ベンチマークスクリプト

ソース: [`scripts/benchmark.rb`](../scripts/benchmark.rb)

ベンチマーク実行方法:
```bash
ruby scripts/benchmark.rb /path/to/rails/project
```
